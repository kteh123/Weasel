<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>WEASEL.Displays.ImageViewers.ImageViewerROI API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>WEASEL.Displays.ImageViewers.ImageViewerROI</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from PyQt5 import QtCore 
from PyQt5 import QtWidgets
from PyQt5.QtGui import QPixmap, QIcon, QCursor
from PyQt5.QtCore import (Qt, pyqtSignal)
from PyQt5.QtWidgets import (QApplication,
                            QFileDialog,                            
                            QMessageBox, 
                            QWidget, 
                            QGridLayout, 
                            QVBoxLayout, 
                            QHBoxLayout, 
                            QMdiSubWindow, 
                            QGroupBox, 
                            QDoubleSpinBox,
                            QPushButton,  
                            QLabel,  
                            QSlider, 
                            QCheckBox,
                            QSpacerItem,
                            QComboBox)

import os
import scipy
import matplotlib.pyplot as plt
from matplotlib import cm
import numpy as np
import math
from scipy.ndimage.morphology import binary_dilation, binary_closing
from scipy.stats import iqr
import DICOM.ReadDICOM_Image as ReadDICOM_Image
import DICOM.SaveDICOM_Image as SaveDICOM_Image
import Trash.InputDialog as inputDialog # obsolete - replace by user_input

from Displays.ImageViewers.ComponentsUI.FreeHandROI.GraphicsView import GraphicsView
from Displays.ImageViewers.ComponentsUI.FreeHandROI.Resources import * 
from Displays.ImageViewers.ComponentsUI.ImageSliders  import ImageSliders as imageSliders
from Displays.ImageViewers.ComponentsUI.ImageLevelsSpinBoxes import ImageLevelsSpinBoxes as imageLevelsSpinBoxes
from Displays.ImageViewers.ComponentsUI.PixelValueLabel import PixelValueComponent 

import logging
logger = logging.getLogger(__name__)

__author__ = &#34;Steve Shillitoe&#34;
#September 2021

#Subclassing QSlider so that the direction (Forward, Backward) of 
#slider travel is returned to the calling function
#This class is used to create a hidden slider used 
#for zooming the image
class Slider(QSlider):
    Nothing, Forward, Backward = 0, 1, -1
    directionChanged = pyqtSignal(int)
    def __init__(self, parent=None):
        QSlider.__init__(self, parent)
        self._direction = Slider.Nothing
        self.last = self.value()/self.maximum()
        self.valueChanged.connect(self.onValueChanged)

    def onValueChanged(self, value):
        current = value/self.maximum()
        direction = Slider.Forward if self.last &lt; current else Slider.Backward
        if self._direction != direction:
            self.directionChanged.emit(direction)
            self._direction = direction
        self.last = current

    def direction(self):
        return self._direction


class ImageViewerROI(QMdiSubWindow):
    &#34;&#34;&#34;This class creates a subwindow for viewing an image or series of images with
    the facility to draw a ROI on the image.  It also has multiple
    sliders for browsing series of images.&#34;&#34;&#34;

    def __init__(self, weasel, dcm): 
        try:
            super().__init__()
            self.subjectID = dcm.subjectID
            self.studyID = dcm.studyID
            self.seriesID = dcm.seriesID
            if dcm.__class__.__name__ == &#34;Image&#34;:
                self.imagePathList = dcm.path
            elif dcm.__class__.__name__ == &#34;Series&#34;:
                self.imagePathList = dcm.images
            self.selectedImagePath = &#34;&#34;
            self.imageNumber = -1
            self.weasel = weasel
            self.numberOfImages = len(self.imagePathList)
            
            if dcm.__class__.__name__ == &#34;Image&#34;:
                self.isSeries = False
                self.isImage = True
                self.selectedImagePath = dcm.path
            else:
                self.isSeries = True
                self.isImage = False

            self.setWindowFlags(Qt.CustomizeWindowHint | 
                                          Qt.WindowCloseButtonHint | 
                                          Qt.WindowMinimizeButtonHint |
                                          Qt.WindowMaximizeButtonHint)
        
            height, width = self.weasel.getMDIAreaDimensions()
            self.subWindowWidth = width
            #Set dimensions of the subwindow to fit the MDI area
            self.setGeometry(0, 0, width, height)
            #Add subwindow to MDI
            self.weasel.mdiArea.addSubWindow(self)
                
            self.setUpMainLayout() 

            self.setUpTopRowLayout()

            self.setUpGraphicsView()

            self.setUpLevelsSpinBoxes()

            self.setUpZoomSlider()

            self.setUpROIButtons()

            if dcm.__class__.__name__ == &#34;Image&#34;:
                self.displayPixelArrayOfSingleImage(self.imagePathList )
            else:
                #DICOM series selected
                self.setUpImageSliders()

            self.show()
        except Exception as e:
            print(&#39;Error in ImageViewerROI.__init__: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.__init__: &#39; + str(e))


    def setUpMainLayout(self):
        try:
            self.mainVerticalLayout = QVBoxLayout()
            self.widget = QWidget()
            self.widget.setLayout(self.mainVerticalLayout)
            self.setWidget(self.widget)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpMainLayout: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpMainLayout: &#39; + str(e))


    def setUpRoiToolsLayout(self):
        self.roiToolsLayout = QHBoxLayout()
        self.roiToolsLayout.setContentsMargins(0, 0, 0, 0)
        self.roiToolsLayout.setSpacing(0)
        self.roiToolsGroupBox = QGroupBox()
        self.roiToolsGroupBox.setFixedHeight(45)
        self.roiToolsGroupBox.setLayout(self.roiToolsLayout)


    def setUpROIDropDownList(self):
        self.cmbNamesROIs = QComboBox()
        self.cmbNamesROIs.setDuplicatesEnabled(False)
        self.cmbNamesROIs.addItem(&#34;region1&#34;)
        self.cmbNamesROIs.setSizeAdjustPolicy(QComboBox.AdjustToContents)
        self.graphicsView.currentROIName = &#34;region1&#34;
        self.cmbNamesROIs.setCurrentIndex(0)
        self.cmbNamesROIs.setStyleSheet(&#39;QComboBox {font: 11pt Arial}&#39;)
        self.cmbNamesROIs.setToolTip(&#34;Displays a list of ROIs created&#34;)
        self.cmbNamesROIs.setEditable(True)
        self.cmbNamesROIs.setInsertPolicy(QComboBox.InsertAtCurrent)


    def connectSlotToSignalForROITools(self):
        self.btnDeleteROI.clicked.connect(self.graphicsView.deleteROI)
        self.btnNewROI.clicked.connect(self.graphicsView.newROI)
        self.btnResetROI.clicked.connect(self.graphicsView.resetROI)
        self.btnSaveROI.clicked.connect(self.saveROI)
        self.btnLoad.clicked.connect(self.loadROI)
        self.btnErase.clicked.connect(lambda checked: self.eraseROI(checked))
        self.btnDraw.clicked.connect(lambda checked: self.drawROI(checked))
        self.btnPaint.clicked.connect(lambda checked: self.paintROI(checked))
        self.btnZoom.clicked.connect(lambda checked: self.zoomImage(checked))
        self.cmbNamesROIs.currentIndexChanged.connect(self.loadImageInImageItem)
        self.cmbNamesROIs.editTextChanged.connect(lambda text: self.roiNameChanged(text))


    def roiNameChanged(self, newText):
        try:
            logger.info(&#34;ImageViewerROI.roiNameChanged called&#34;)
            currentIndex = self.cmbNamesROIs.currentIndex()
            #Prevent spaces in new ROI name
            if &#39; &#39; in newText:
                newText = newText.replace(&#34; &#34;, &#34;&#34;)
                self.cmbNamesROIs.setItemText(currentIndex, newText)
                self.cmbNamesROIs.setCurrentText(newText)
            index = self.cmbNamesROIs.findText(newText);
            if index == -1:
                self.cmbNamesROIs.setItemText(currentIndex, newText);
                nameChangedOK = self.graphicsView.dictROIs.renameDictionaryKey(newText)
                if nameChangedOK == False:
                    msgBox = QMessageBox()
                    msgBox.setWindowTitle(&#34;ROI Name Change&#34;)
                    msgBox.setText(&#34;This name is already in use&#34;)
                    msgBox.exec()
                    cmbNamesROIs.setCurrentText(self.graphicsView.dictROIs.prevRegionName)

        except Exception as e:
                print(&#39;Error in ImageViewerROI.roiNameChanged: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.roiNameChanged: &#39; + str(e)) 


    def saveROI(self):
        try:
            # Save Current ROI
            logger.info(&#34;ImageViewerROI.saveROI called&#34;)
            regionName = self.cmbNamesROIs.currentText()
            # get the list of boolean masks for this series
            maskList = self.graphicsView.dictROIs.dictMasks[regionName] 
            # Convert each 2D boolean to 0s and 1s
            maskList = [np.transpose(np.array(mask, dtype=np.int)) for mask in maskList]
            suffix = str(&#34;_ROI_&#34;+ regionName)
            if len(maskList) &gt; 1:
                #inputPath = [i.path for i in self.weasel.images()]
                inputPath = self.imagePathList 
            else:
                inputPath = [self.selectedImagePath]
            # Saving Progress message
            self.weasel.progress_bar(msg=&#34;&lt;H4&gt;Saving ROIs into a new DICOM Series ({} files)&lt;/H4&gt;&#34;.format(len(inputPath)))
            self.weasel.progressBar.set_maximum(len(inputPath))
            (subjectID, studyID, seriesID) = self.weasel.objXMLReader.getImageParentIDs(inputPath[0])
            seriesID = str(int(self.weasel.objXMLReader.getStudy(subjectID, studyID)[-1].attrib[&#39;id&#39;].split(&#39;_&#39;)[0]) + 1)
            seriesUID = SaveDICOM_Image.generateUIDs(ReadDICOM_Image.getDicomDataset(inputPath[0]), seriesID)
            for index, path in enumerate(inputPath):
                self.weasel.progressBar.set_value(index)
                outputPath = SaveDICOM_Image.returnFilePath(path, suffix)
                SaveDICOM_Image.saveNewSingleDicomImage(outputPath, path, maskList[index], suffix, series_id=seriesID, series_uid=seriesUID, parametric_map=&#34;SEG&#34;)
                if &#34;philips&#34; in ReadDICOM_Image.getImageTagValue(outputPath, &#34;Manufacturer&#34;).lower():
                    slope = ReadDICOM_Image.getImageTagValue(outputPath, &#34;RescaleSlope&#34;)
                    SaveDICOM_Image.overwriteDicomFileTag(outputPath, (0x2005, 0x100E), 1/slope) #[(0x2005, 0x100E)]
                self.weasel.objXMLReader.insertNewImageInXMLFile(path, outputPath, suffix)
            self.weasel.progressBar.set_value(len(inputPath))
            self.weasel.progressBar.close()
            self.weasel.refresh()
            QMessageBox.information(self.weasel, &#34;Export ROIs&#34;, &#34;Image Saved&#34;)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.saveROI: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.saveROI: &#39; + str(e)) 


    def loadROI(self):
        try:
            logger.info(&#34;ImageViewerROI.loadROI called&#34;)
            # The following workflow is assumed:
            #   1. The user first loads a series of DICOM images
            #   2. Then the user chooses the series with the mask that will overlay the current viewer.

            # Prompt Windows to select Series
            paramDict = {&#34;Series&#34;:&#34;listview&#34;}
            helpMsg = &#34;Select a Series with ROI&#34;
            #studyID = self.selectedStudy
            study = self.weasel.objXMLReader.getStudy(self.subjectID, self.studyID)
            listSeries = [series.attrib[&#39;id&#39;] for series in study] # if &#39;ROI&#39; in series.attrib[&#39;id&#39;]]
            inputDlg = inputDialog.ParameterInputDialog(paramDict, title= &#34;Load ROI&#34;, helpText=helpMsg, lists=[listSeries])
            listParams = inputDlg.returnListParameterValues()
            if inputDlg.closeInputDialog() == False:
                # for series ID in listParams[0]: # more than 1 ROI may be selected
                seriesID = listParams[0][0] # Temporary, only the first ROI
                imagePathList = self.weasel.objXMLReader.getImagePathList(self.subjectID, self.studyID, seriesID)
                if self.weasel.series != []:
                    #targetPath = [i.path for i in self.weasel.images()]
                    targetPath = self.imagePathList
                else:
                    targetPath = [self.selectedImagePath]
                maskInput = ReadDICOM_Image.returnSeriesPixelArray(imagePathList)
                maskInput[maskInput != 0] = 1
                maskList = [] # Output Mask
                # Consider DICOM Tag SegmentSequence[:].SegmentLabel as some 3rd software do
                if hasattr(ReadDICOM_Image.getDicomDataset(imagePathList[0]), &#34;ContentDescription&#34;):
                    region = ReadDICOM_Image.getSeriesTagValues(imagePathList, &#34;ContentDescription&#34;)[0][0]
                else:
                    region = &#34;new_region_label&#34;
                # Affine re-adjustment
                for index, dicomFile in enumerate(targetPath):
                    self.weasel.progress_bar(msg=&#34;&lt;H4&gt;Loading selected ROI into target image {}&lt;/H4&gt;&#34;.format(index + 1))
                    self.weasel.progressBar.set_maximum(len(targetPath))
                    self.weasel.progressBar.set_value(index + 1)
                    dataset_original = ReadDICOM_Image.getDicomDataset(dicomFile)
                    tempArray = np.zeros(np.shape(ReadDICOM_Image.getPixelArray(dataset_original)))
                    horizontalFlag = None
                    verticalFlag = None
                    for maskFile in imagePathList:
                        dataset = ReadDICOM_Image.getDicomDataset(maskFile)
                        maskArray = ReadDICOM_Image.getPixelArray(dataset)
                        maskArray[maskArray != 0] = 1
                        affineResults = ReadDICOM_Image.mapMaskToImage(maskArray, dataset, dataset_original)
                        if affineResults:
                            try:
                                coords = zip(*affineResults)
                                tempArray[tuple(coords)] = list(np.ones(len(affineResults)).flatten())
                                #if len(np.unique([idx[0] for idx in affineResults])) == 1 and len(np.unique([idx[1] for idx in affineResults])) != 1: horizontalFlag = True
                                #if len(np.unique([idx[1] for idx in affineResults])) == 1 and len(np.unique([idx[0] for idx in affineResults])) != 1: verticalFlag = True
                            except:
                                pass
                    # Will need an Enhanced MRI as example  
                    #if ~hasattr(dataset_original, &#39;PerFrameFunctionalGroupsSequence&#39;):
                        #if horizontalFlag == True:
                            #struct_elm = np.ones((int(dataset_original.SliceThickness / dataset.PixelSpacing[0]), 1)) # Change /2 value here
                            #tempArray = binary_dilation(tempArray, structure=struct_elm).astype(int)
                            #tempArray = binary_closing(tempArray, structure=struct_elm).astype(int)
                        #elif verticalFlag == True:
                            #struct_elm = np.ones((1, int(dataset_original.SliceThickness / dataset.PixelSpacing[1]))) # Change /2 value here
                            #tempArray = binary_dilation(tempArray, structure=struct_elm).astype(int)
                            #tempArray = binary_closing(tempArray, structure=struct_elm).astype(int)
                    maskList.append(tempArray)
                    self.weasel.progressBar.set_value(index+2)
                self.weasel.progressBar.close()

                # Faster approach - 3D and no dilation
                #maskList = np.zeros(np.shape(ReadDICOM_Image.returnSeriesPixelArray(targetPath)))
                #dataset_original = ReadDICOM_Image.getDicomDataset(targetPath)
                #dataset = ReadDICOM_Image.getDicomDataset(imagePathList[0])
                #affineResults = ReadDICOM_Image.mapMaskToImage(maskInput, dataset, dataset_original)
                #if affineResults:
                    #try:
                        #coords = zip(*affineResults)
                        #maskList[tuple(coords)] = list(np.ones(len(affineResults)).flatten())
                    #except:
                        #pass
            
                # First populate the ROI_Storage data structure in a loop
                self.graphicsView.currentROIName = region
                for imageNumber in range(len(maskList)):  #To Do
                    self.graphicsView.currentImageNumber = imageNumber + 1
                    self.graphicsView.dictROIs.addMask(np.array(maskList[imageNumber]).astype(bool))

                # Second populate the dropdown list of region names
                self.cmbNamesROIs.blockSignals(True)
                #remove previous contents of ROI dropdown list
                self.cmbNamesROIs.clear()  
                self.cmbNamesROIs.addItems(self.graphicsView.dictROIs.getListOfRegions())
                self.cmbNamesROIs.blockSignals(False)

                # Redisplay the current image to show the mask
                #mask = graphicsView.dictROIs.getMask(region, 1)
                #graphicsView.graphicsItem.reloadMask(mask)
                self.cmbNamesROIs.setCurrentIndex(self.cmbNamesROIs.count() - 1)
                self.loadImageInImageItem()
        except Exception as e:
                print(&#39;Error in ImageViewerROI.loadROI: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.loadROI: &#39; + str(e)) 


    def eraseROI(self, checked):
        logger.info(&#34;ImageViewerROI.eraseROI called.&#34;)
        if checked:
            self.setButtonsToDefaultStyle(self.btnErase)
            self.btnErase.setStyleSheet(&#34;background-color: red&#34;)
            self.graphicsView.eraseROI()
        else:
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.graphicsItem.eraseEnabled = False
            self.btnErase.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )


    def setButtonsToDefaultStyle(self, thisButton=None):
        logger.info(&#34;DisplayImageDrawRIO.setButtonsToDefaultStyle called&#34;)
        try:
            logger.info(&#34;ImageViewerROI.setButtonsToDefaultStyle called.&#34;)
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.graphicsItem.drawEnabled = False
            self.graphicsView.graphicsItem.eraseEnabled = False
            self.graphicsView.graphicsItem.paintEnabled = False
            if len(self.buttonList) &gt; 0:
                for button in self.buttonList:
                    button.setStyleSheet(
                     &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                     )
                    if button == thisButton:
                            continue
                    button.setChecked(False)
        except Exception as e:
                print(&#39;Error in ImageViewerROI.setButtonsToDefaultStyle: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.setButtonsToDefaultStyle: &#39; + str(e))  


    def drawROI(self, checked):
        logger.info(&#34;ImageViewerROI.drawROI called.&#34;)
        if checked:
            self.setButtonsToDefaultStyle(self.btnDraw)
            self.btnDraw.setStyleSheet(&#34;background-color: red&#34;)
            self.graphicsView.drawROI()
        else:
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.graphicsItem.drawEnabled = False
            self.btnDraw.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )


    def paintROI(self, checked):
        logger.info(&#34;ImageViewerROI.paintROI called.&#34;)
        if checked:
            self.setButtonsToDefaultStyle(self.btnPaint)
            self.btnPaint.setStyleSheet(&#34;background-color: red&#34;)
            self.graphicsView.paintROI()
        else:
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.graphicsItem.paintEnabled = False
            self.btnPaint.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )


    def zoomImage(self, checked):
        logger.info(&#34;ImageViewerROI.zoomImage called.&#34;)
        if checked:
            self.setButtonsToDefaultStyle()
            self.graphicsView.setZoomEnabled(True)
            self.graphicsView.graphicsItem.paintEnabled = False
            self.graphicsView.graphicsItem.drawEnabled = False
            self.graphicsView.graphicsItem.eraseEnabled = False
            self.btnZoom.setStyleSheet(&#34;background-color: red&#34;)
        else:
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.setZoomEnabled(False)
            self.btnZoom.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )

    
    def getRoiMeanAndStd(self, mask, pixelArray):
        try:
            logger.info(&#34;ImageViewerROI.getRoiMeanAndStd called&#34;)
            mean = round(np.mean(np.extract(mask, pixelArray)), 1)
            std = round(np.std(np.extract(mask, pixelArray)), 1)
            return mean, std
        except Exception as e:
            print(&#39;Error in ImageViewerROI.getRoiMeanAndStd: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.getRoiMeanAndStd: &#39; + str(e))


    def displayROIMeanAndStd(self):
        try:
            logger.info(&#34;ImageViewerROI.displayROIMeanAndStd called&#34;)
            #print(&#34;ImageViewerROI.displayROIMeanAndStd called&#34;) ##
            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1
            pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
            regionName = self.cmbNamesROIs.currentText()
            mask = self.graphicsView.dictROIs.getMask(regionName, imageNumber)   
            if mask is not None:
                #print(&#34;mask is not none, size={}&#34;.format(len(mask)))##
                mean, std = self.getRoiMeanAndStd(mask, pixelArray)
                #print(&#34;mean ={}, std ={}&#34;.format(mean, std)) ##
                self.roiMeanTxt.setText(&#34;Mean: &#34; + str(mean))
                self.roiStdDevTxt.setText(&#34;SD: &#34; + str(std))
            else:
                self.roiMeanTxt.clear()
                self.roiStdDevTxt.clear()
        except Exception as e:
                print(&#39;Error in ImageViewerROI.displayROIMeanAndStd: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.displayROIMeanAndStd: &#39; + str(e)) 


    def setUpImageEventHandlers(self):
        logger.info(&#34;ImageViewerROI.setUpImageEventHandlers called.&#34;)
        try:
            self.graphicsView.graphicsItem.sigRightMouseDrag.connect(
                lambda deltaX, deltaY: self.adjustLevelsByRightMouseButtonDrag(
                                        deltaX, deltaY))

            self.graphicsView.graphicsItem.sigMouseHovered.connect(
            lambda mouseOverImage:self.getPixelValue(mouseOverImage))

            self.graphicsView.graphicsItem.sigGetDetailsROI.connect(self.updateDetailsROI)

            self.graphicsView.graphicsItem.sigRecalculateMeanROI.connect(self.displayROIMeanAndStd)

            #self.graphicsView.sigContextMenuDisplayed.connect(self.setButtonsToDefaultStyle)
            
            self.graphicsView.sigReloadImage.connect(self.loadImageInImageItem)

            self.graphicsView.sigROIDeleted.connect(self.deleteROITidyUp)

            self.graphicsView.sigSetDrawButtonRed.connect(lambda setRed:
                                                          self.setDrawButtonColour(setRed))

            self.graphicsView.sigSetEraseButtonRed.connect(lambda setRed:
                                                           self.setEraseButtonColour(setRed))

            self.graphicsView.sigSetPaintButtonRed.connect(lambda setRed:
                                                           self.setPaintButtonColour(setRed))

            #self.graphicsView.sigROIChanged.connect(self.setButtonsToDefaultStyle)
            self.graphicsView.sigROIChanged.connect(self.updateROIName)
            self.graphicsView.sigNewROI.connect(lambda newROIName:
                                                self.addNewROItoDropDownList(newROIName))
            self.graphicsView.sigUpdateZoom.connect(lambda increment:
                                                    self.updateZoomSlider(increment))
        except Exception as e:
                print(&#39;Error in ImageViewerROI.setUpImageEventHandlers: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.setUpImageEventHandlers: &#39; + str(e)) 


    def adjustLevelsByRightMouseButtonDrag(self, deltaX, deltaY):
        try:
            self.levelsCompositeComponentLayout.blockLevelsSpinBoxSignals(True)
            centre = self.spinBoxIntensity.value()
            width = self.spinBoxContrast.value()
            if float(centre / np.shape(self.pixelArray)[1]) &gt; 0.01:
                step_y = float(centre / np.shape(self.pixelArray)[1])
            else:
                step_y = 0.01
            if float(width / np.shape(self.pixelArray)[0]) &gt; 0.01:
                step_x = float(width/ np.shape(self.pixelArray)[0])
            else:
                step_x = 0.01
            horizontalDiff = step_y * deltaY
            verticalDiff = step_x * deltaX # Maybe put a minus sign here
            newCentre = centre + horizontalDiff
            newWidth = width + verticalDiff
            self.spinBoxIntensity.setValue(newCentre)
            self.spinBoxContrast.setValue(newWidth)
            self.updateImageLevels()
            self.levelsCompositeComponentLayout.blockLevelsSpinBoxSignals(False)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.adjustLevelsByRightMouseButtonDrag: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.adjustLevelsByRightMouseButtonDrag: &#39; + str(e))

    
    def updateZoomSlider(self, increment):
        &#34;&#34;&#34;This function updates the position of the slider on the image
        zoom slider and calculates the % zoom for display in the label zoomLabel.
        Although, the zoom slider widget is not displayed on the screen,
        this function is a convenient way to keep track of the current image
        zoom value&#34;&#34;&#34;
        try:
            logger.info(&#34;DisplayImageDrawRIO.updateZoomSlider called&#34;)
            self.zoomSlider.blockSignals(True)
            if increment == 0:
                self.zoomSlider.setValue(0)
                self.zoomValueLabel.setText(&#34;&lt;H4&gt;100%&lt;/H4&gt;&#34;)
            else:
                newValue = self.zoomSlider.value() + increment
                newZoomValue = 100 + (newValue * 25)
                self.zoomValueLabel.setText(&#34;&lt;H4&gt;&#34; + str(newZoomValue) + &#34;%&lt;/H4&gt;&#34;)
                if self.zoomSlider.value() &lt; self.zoomSlider.maximum() and increment &gt; 0:
                    self.zoomSlider.setValue(newValue)
                elif self.zoomSlider.value() &gt; self.zoomSlider.minimum() and increment &lt; 0:
                    self.zoomSlider.setValue(newValue)
            self.zoomSlider.blockSignals(False)
        except Exception as e:
                print(&#39;Error in ImageViewerROI.updateZoomSlider: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.updateZoomSlider: &#39; + str(e))


    def addNewROItoDropDownList(self, newRegion):
        logger.info(&#34;ImageViewerROI.addNewROItoDropDownList called.&#34;)
        noDuplicate = True
        for count in range(self.cmbNamesROIs.count()):
             if self.cmbNamesROIs.itemText(count) == newRegion:
                 noDuplicate = False
                 break
        if noDuplicate:
            self.cmbNamesROIs.blockSignals(True)
            self.cmbNamesROIs.addItem(newRegion)
            self.cmbNamesROIs.setCurrentIndex(self.cmbNamesROIs.count() - 1)
            self.cmbNamesROIs.blockSignals(False)


    def updateROIName(self):
        logger.info(&#34;ImageViewerROI.updateROIName called.&#34;)
        self.graphicsView.currentROIName = self.cmbNamesROIs.currentText()

    
    def setUpPixelValueGroupBox(self):
        pixelValueComponent = PixelValueComponent()
        self.lblPixelValue = pixelValueComponent.getLabel()
        self.pixelValueGroupBox = QGroupBox(&#34;Pixel Value&#34;)
        self.pixelValueGroupBox.setFixedHeight(45)
        self.pixelValueGroupBox.setLayout(pixelValueComponent.getLayout()) 


    def setUpZoomGroupBox(self):
        self.zoomValueLabel = QLabel(&#34;&lt;H4&gt;100%&lt;/H4&gt;&#34;)
        self.zoomValueLabel.setStyleSheet(&#34;color:red; padding-left:1; margin-left:1; font-size:8pt;&#34;)
        layout = QHBoxLayout()
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        layout.addWidget(self.zoomValueLabel, alignment = Qt.AlignCenter)
        self.zoomGroupBox = QGroupBox(&#34;Zoom&#34;)
        self.zoomGroupBox.setFixedHeight(45)
        self.zoomGroupBox.setLayout(layout) 


    def getPixelValue(self, mouseOverImage):
        try:
            logger.info(&#34;ImageViewerROI.getPixelValue called&#34;)
            if mouseOverImage:
                xCoord = math.floor(self.graphicsView.graphicsItem.xMouseCoord)
                yCoord = math.floor(self.graphicsView.graphicsItem.yMouseCoord)
                #correct the y coordinate value so that it has a value
                #of 0 at the bottom left corner of the image rather than
                #at the top left corner of the image
                _, nY = self.pixelArray.shape
                correctedYCoord = nY - yCoord
                pixelValue = self.graphicsView.graphicsItem.pixelValue
                strValue = str(pixelValue)
                if self.isSeries:  
                    imageNumber = self.mainImageSlider.value()
                else:
                    imageNumber = 1
                strPosition = &#39; @ X:&#39; + str(xCoord) + &#39;, Y:&#39; + str(correctedYCoord ) + &#39;, Z:&#39; + str(imageNumber)
                self.lblPixelValue.setWordWrap(True)
                self.lblPixelValue.setText(strValue + &#39;\n&#39; + strPosition)
            else:
                 self.lblPixelValue.setText(&#39;&#39;)
        except Exception as e:
                print(&#39;Error in ImageViewerROI.getPixelValue: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.getPixelValue: &#39; + str(e))


    def updateDetailsROI(self):
        logger.info(&#34;ImageViewerROI.updateDetailsROI called&#34;)
        try:
            self.graphicsView.currentROIName = self.cmbNamesROIs.currentText()
            if self.isSeries:  
                self.graphicsView.currentImageNumber = self.mainImageSlider.value()
            else:
                self.graphicsView.currentImageNumber = 1
        except Exception as e:
                print(&#39;Error in ImageViewerROI.updateDetailsROI: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.updateDetailsROI: &#39; + str(e))


    def replaceMask(self):  
        logger.info(&#34;ImageViewerROI.replaceMask called&#34;)
        regionName = self.cmbNamesROIs.currentText()
        if self.isSeries:  
            imageNumber = self.mainImageSlider.value()
        else:
            imageNumber = 1
        mask = self.graphicsView.graphicsItem.getMaskData()
        self.graphicsView.dictROIs.replaceMask(regionName, mask, imageNumber)


    def setUpROIButtons(self):
        try:
            logger.info(&#34;ImageViewerROI.setUpPixelDataWidget called.&#34;)
            self.buttonList = []
            self.setUpROIDropDownList()

            self.btnDeleteROI = QPushButton() 
            self.btnDeleteROI.setToolTip(&#39;Delete the current ROI&#39;)
            self.btnDeleteROI.setIcon(QIcon(QPixmap(DELETE_ICON)))
        
            self.btnNewROI = QPushButton() 
            self.btnNewROI.setToolTip(&#39;Add a new ROI&#39;)
            self.btnNewROI.setIcon(QIcon(QPixmap(NEW_ICON)))

            self.btnResetROI = QPushButton()
            self.btnResetROI.setToolTip(&#39;Clears the ROI from the image&#39;)
            self.btnResetROI.setIcon(QIcon(QPixmap(RESET_ICON)))

            self.btnSaveROI = QPushButton()
            self.btnSaveROI.setToolTip(&#39;Saves the ROI in DICOM format&#39;)
            self.btnSaveROI.setIcon(QIcon(QPixmap(SAVE_ICON)))

            self.btnLoad = QPushButton()
            self.btnLoad.setToolTip(&#39;Loads existing ROIs&#39;)
            self.btnLoad.setIcon(QIcon(QPixmap(LOAD_ICON)))

            self.btnErase = QPushButton()
            self.buttonList.append(self.btnErase)
            self.btnErase.setToolTip(&#34;Erase the ROI. Right click to change eraser size.&#34;)
            self.btnErase.setCheckable(True)
            self.btnErase.setIcon(QIcon(QPixmap(ERASER_CURSOR)))

            self.btnDraw = QPushButton()
            self.buttonList.append(self.btnDraw)
            self.btnDraw.setToolTip(&#34;Draw an ROI&#34;)
            self.btnDraw.setCheckable(True)
            self.btnDraw.setIcon(QIcon(QPixmap(PEN_CURSOR)))

            self.btnPaint = QPushButton()
            self.buttonList.append(self.btnPaint)
            self.btnPaint.setToolTip(&#34;Paint an ROI&#34;)
            self.btnPaint.setCheckable(True)
            self.btnPaint.setIcon(QIcon(QPixmap(BRUSH_CURSOR)))

            self.btnZoom = QPushButton()
            self.buttonList.append(self.btnZoom)
            self.btnZoom.setToolTip(&#34;Zoom In-Left Mouse Button/Zoom Out-Right Mouse Button&#34;)
            self.btnZoom.setCheckable(True)
            self.btnZoom.setIcon(QIcon(QPixmap(MAGNIFYING_GLASS_CURSOR)))

            self.roiMeanTxt = QLabel()
            self.roiMeanTxt.setStyleSheet(&#34;color : red; padding-left:0; margin-left:0; font-size:8pt;&#34;)
            self.roiMeanTxt.setToolTip(&#34;ROI Mean Value&#34;)
            self.roiStdDevTxt = QLabel()
            self.roiStdDevTxt.setStyleSheet(&#34;color : red; padding-left:0; margin-left:0; font-size:8pt;&#34;)
            self.roiStdDevTxt.setToolTip(&#34;ROI Mean Value Standard Deviation&#34;)
            self.connectSlotToSignalForROITools()

            self.roiToolsLayout.addWidget(self.cmbNamesROIs, alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnNewROI, alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnResetROI,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnDeleteROI,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnSaveROI,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnLoad,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnDraw,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnPaint,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnErase, alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnZoom,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.roiMeanTxt,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.roiStdDevTxt,  alignment=Qt.AlignLeft)
        except Exception as e:
               print(&#39;Error in ImageViewerROI.setUpROIButtons: &#39; + str(e))
               logger.exception(&#39;Error in ImageViewerROI.setUpROIButtons: &#39; + str(e)) 

            
    def loadImageInImageItem(self): ###
        try:
            logger.info(&#34;ImageViewerROI.loadImageInImageItem called&#34;)
            self.graphicsView.dictROIs.setPreviousRegionName(self.cmbNamesROIs.currentText())

            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1

            pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
            mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
            self.graphicsView.setImage(self.pixelArray, mask, self.selectedImagePath)
            self.displayROIMeanAndStd()  
            self.setUpImageEventHandlers()
        except Exception as e:
               print(&#39;Error in ImageViewerROI.loadImageInImageItem: &#39; + str(e))
               logger.exception(&#39;Error in ImageViewerROI.loadImageInImageItem: &#39; + str(e))
    

    def deleteROITidyUp(self):
        logger.info(&#34;ImageViewerROI.deleteROITidyUp called&#34;)
        self.loadImageInImageItem() 
        self.displayROIMeanAndStd()
        if self.cmbNamesROIs.currentIndex() == 0 and self.cmbNamesROIs.count() == 1: 
            self.cmbNamesROIs.clear()
            self.cmbNamesROIs.addItem(&#34;region1&#34;)
            self.cmbNamesROIs.setCurrentIndex(0) 
            self.roiMeanTxt.clear()
            self.roiStdDevTxt.clear()
            self.lblPixelValue.clear()
        else:
            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1
            self.cmbNamesROIs.blockSignals(True)
            self.cmbNamesROIs.removeItem(cmbNamesROIs.currentIndex())
            self.cmbNamesROIs.blockSignals(False)
            mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
            self.graphicsView.graphicsItem.reloadMask(mask)


    def setUpImageLevelsLayout(self):
        self.levelsCompositeComponentLayout = imageLevelsSpinBoxes()
        self.imageLevelsGroupBox = QGroupBox()
        self.imageLevelsGroupBox.setFixedHeight(45)
        self.imageLevelsGroupBox.setLayout(self.levelsCompositeComponentLayout.getCompositeComponent())


    def setUpTopRowLayout(self):
        try:
            self.topRowMainLayout = QHBoxLayout()
            
            self.setUpRoiToolsLayout()
            
            self.setUpImageLevelsLayout()

            self.setUpPixelValueGroupBox()

            self.setUpZoomGroupBox()
            
            self.topRowMainLayout.addWidget(self.roiToolsGroupBox)
            self.topRowMainLayout.addWidget(self.imageLevelsGroupBox)
            self.topRowMainLayout.addWidget(self.pixelValueGroupBox)
            self.topRowMainLayout.addWidget(self.zoomGroupBox)

            self.mainVerticalLayout.addLayout(self.topRowMainLayout)

            self.lblImageMissing = QLabel(&#34;&lt;h4&gt;Image Missing&lt;/h4&gt;&#34;)
            self.lblImageMissing.hide()
            self.mainVerticalLayout.addWidget(self.lblImageMissing)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpTopRowLayout: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpTopRowLayout: &#39; + str(e))


    def setUpGraphicsView(self):
        self.graphicsView = GraphicsView(self.numberOfImages)
        self.mainVerticalLayout.addWidget(self.graphicsView) 


    def setUpLevelsSpinBoxes(self):
        try:
            self.spinBoxIntensity, self.spinBoxContrast = self.levelsCompositeComponentLayout.getSpinBoxes() 
            self.spinBoxIntensity.valueChanged.connect(self.updateImageLevels)
            self.spinBoxContrast.valueChanged.connect(self.updateImageLevels)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpLevelsSpinBoxes: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpLevelsSpinBoxes: &#39; + str(e))


    def updateImageLevels(self):
        logger.info(&#34;ImageViewerROI.updateImageLevels called.&#34;)
        try:
            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1
            intensity = self.spinBoxIntensity.value()
            contrast = self.spinBoxContrast.value()
            mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
            self.graphicsView.graphicsItem.updateImageLevels(intensity, contrast, mask)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.updateImageLevels when imageNumber={}: &#39;.format(imageNumber) + str(e))
            logger.exception(&#39;Error in ImageViewerROI.updateImageLevels: &#39; + str(e))


    def setUpImageSliders(self):
        try:
            #create an instance of the ImageSliders class
            self.slidersWidget = imageSliders(self.weasel, 
                                             self.subjectID, 
                                             self.studyID, 
                                             self.seriesID, 
                                             self.imagePathList)

            self.mainVerticalLayout.addLayout(
                    self.slidersWidget.getCustomSliderWidget())

            self.mainImageSlider = self.slidersWidget.getMainSlider()

            #This is how an object created from the ImageSliders class communicates
            #with an object created from the ImageViewerROI class via the former&#39;s
            #sliderMoved event, which passes the image path of the image being viewed
            #to ImageViewerROI&#39;s displayPixelArrayOfSingleImage function for display.
            self.slidersWidget.sliderMoved.connect(lambda imagePath: 
                                                   self.displayPixelArrayOfSingleImage(imagePath))
            #Display the first image in the viewer
            self.slidersWidget.displayFirstImage()
        except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpImageSliders: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpImageSliders: &#39; + str(e))


    def displayPixelArrayOfSingleImage(self, imagePath):
            &#34;&#34;&#34;Displays an image&#39;s pixel array in a pyqtGraph imageView widget 
            &amp; sets its colour table, contrast and intensity levels. 
            Also, sets the contrast and intensity in the associated histogram.
            &#34;&#34;&#34;
            try:
                logger.info(&#34;ImageViewerROI.displayPixelArrayOfSingleImage called&#34;)

                self.selectedImagePath = imagePath
                imageName = os.path.basename(self.selectedImagePath)
                self.pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
                

                self.setWindowTitle(self.subjectID + &#39; - &#39; + self.studyID + &#39; - &#39;+ self.seriesID + &#39; - &#39; 
                         + imageName)

                #Check that pixel array holds an image &amp; display it
                if self.pixelArray is None:
                    self.lblImageMissing.show()
                    self.deleteButton.hide()
                    self.graphicsView.setImage(np.array([[0,0,0],[0,0,0]]))  
                else:
                    self.loadImageInImageItem()
                    self.lblImageMissing.hide()
                    self.setInitialImageLevelValues()

            except Exception as e:
                print(&#39;Error in ImageViewerROI.displayPixelArrayOfSingleImage: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.displayPixelArrayOfSingleImage: &#39; + str(e))


    def setUpZoomSlider(self):
        try:
            self.zoomSlider = Slider(Qt.Vertical)
            self.zoomSlider.setMinimum(0)
            self.zoomSlider.setMaximum(20)
            self.zoomSlider.setSingleStep(1)
            self.zoomSlider.setTickPosition(QSlider.TicksBothSides)
            self.zoomSlider.setTickInterval(1)
            self.zoomSlider.valueChanged.connect(lambda: 
                  self.graphicsView.zoomImage(self.zoomSlider.direction()))
        except Exception as e:
                print(&#39;Error in ImageViewerROI.setUpZoomSlider: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.setUpZoomSlider: &#39; + str(e))  


    def setEraseButtonColour(self, setRed):
        logger.info(&#34;DisplayImageDrawRIO.setEraseButtonColour called&#34;)
        if setRed:
               self.btnErase.setStyleSheet(&#34;background-color: red&#34;)
               self.btnErase.setChecked(True)
               self.btnPaint.setChecked(False)
               self.btnDraw.setChecked(False)
               self.btnDraw.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
               self.btnPaint.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
        else:
               self.btnErase.setChecked(False)
               self.btnErase.setStyleSheet(
                 &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )


    def setDrawButtonColour(self, setRed):
        logger.info(&#34;DisplayImageDrawRIO.setDrawButtonColour called&#34;)
        if setRed:
               self.btnDraw.setStyleSheet(&#34;background-color: red&#34;)
               self.btnDraw.setChecked(True)
               self.btnPaint.setChecked(False)
               self.btnErase.setChecked(False)
               self.btnPaint.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
               self.btnErase.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
        else:
               self.btnDraw.setChecked(False)
               self.btnDraw.setStyleSheet(
                 &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )


    def setPaintButtonColour(self, setRed):
        logger.info(&#34;DisplayImageDrawRIO.setPaintButtonColour called&#34;)
        if setRed:
               self.btnPaint.setStyleSheet(&#34;background-color: red&#34;)
               self.btnPaint.setChecked(True)
               self.btnDraw.setChecked(False)
               self.btnErase.setChecked(False)
               self.btnDraw.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
               self.btnErase.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
        else:
               self.btnPaint.setChecked(False)
               self.btnPaint.setStyleSheet(
                 &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )


    def setInitialImageLevelValues(self):
        self.spinBoxIntensity.blockSignals(True)
        self.spinBoxIntensity.setValue(self.graphicsView.graphicsItem.intensity)
        self.spinBoxIntensity.blockSignals(False)
        self.spinBoxContrast.blockSignals(True)
        self.spinBoxContrast.setValue(self.graphicsView.graphicsItem.contrast)
        self.spinBoxContrast.blockSignals(False)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI"><code class="flex name class">
<span>class <span class="ident">ImageViewerROI</span></span>
<span>(</span><span>weasel, dcm)</span>
</code></dt>
<dd>
<div class="desc"><p>This class creates a subwindow for viewing an image or series of images with
the facility to draw a ROI on the image.
It also has multiple
sliders for browsing series of images.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ImageViewerROI(QMdiSubWindow):
    &#34;&#34;&#34;This class creates a subwindow for viewing an image or series of images with
    the facility to draw a ROI on the image.  It also has multiple
    sliders for browsing series of images.&#34;&#34;&#34;

    def __init__(self, weasel, dcm): 
        try:
            super().__init__()
            self.subjectID = dcm.subjectID
            self.studyID = dcm.studyID
            self.seriesID = dcm.seriesID
            if dcm.__class__.__name__ == &#34;Image&#34;:
                self.imagePathList = dcm.path
            elif dcm.__class__.__name__ == &#34;Series&#34;:
                self.imagePathList = dcm.images
            self.selectedImagePath = &#34;&#34;
            self.imageNumber = -1
            self.weasel = weasel
            self.numberOfImages = len(self.imagePathList)
            
            if dcm.__class__.__name__ == &#34;Image&#34;:
                self.isSeries = False
                self.isImage = True
                self.selectedImagePath = dcm.path
            else:
                self.isSeries = True
                self.isImage = False

            self.setWindowFlags(Qt.CustomizeWindowHint | 
                                          Qt.WindowCloseButtonHint | 
                                          Qt.WindowMinimizeButtonHint |
                                          Qt.WindowMaximizeButtonHint)
        
            height, width = self.weasel.getMDIAreaDimensions()
            self.subWindowWidth = width
            #Set dimensions of the subwindow to fit the MDI area
            self.setGeometry(0, 0, width, height)
            #Add subwindow to MDI
            self.weasel.mdiArea.addSubWindow(self)
                
            self.setUpMainLayout() 

            self.setUpTopRowLayout()

            self.setUpGraphicsView()

            self.setUpLevelsSpinBoxes()

            self.setUpZoomSlider()

            self.setUpROIButtons()

            if dcm.__class__.__name__ == &#34;Image&#34;:
                self.displayPixelArrayOfSingleImage(self.imagePathList )
            else:
                #DICOM series selected
                self.setUpImageSliders()

            self.show()
        except Exception as e:
            print(&#39;Error in ImageViewerROI.__init__: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.__init__: &#39; + str(e))


    def setUpMainLayout(self):
        try:
            self.mainVerticalLayout = QVBoxLayout()
            self.widget = QWidget()
            self.widget.setLayout(self.mainVerticalLayout)
            self.setWidget(self.widget)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpMainLayout: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpMainLayout: &#39; + str(e))


    def setUpRoiToolsLayout(self):
        self.roiToolsLayout = QHBoxLayout()
        self.roiToolsLayout.setContentsMargins(0, 0, 0, 0)
        self.roiToolsLayout.setSpacing(0)
        self.roiToolsGroupBox = QGroupBox()
        self.roiToolsGroupBox.setFixedHeight(45)
        self.roiToolsGroupBox.setLayout(self.roiToolsLayout)


    def setUpROIDropDownList(self):
        self.cmbNamesROIs = QComboBox()
        self.cmbNamesROIs.setDuplicatesEnabled(False)
        self.cmbNamesROIs.addItem(&#34;region1&#34;)
        self.cmbNamesROIs.setSizeAdjustPolicy(QComboBox.AdjustToContents)
        self.graphicsView.currentROIName = &#34;region1&#34;
        self.cmbNamesROIs.setCurrentIndex(0)
        self.cmbNamesROIs.setStyleSheet(&#39;QComboBox {font: 11pt Arial}&#39;)
        self.cmbNamesROIs.setToolTip(&#34;Displays a list of ROIs created&#34;)
        self.cmbNamesROIs.setEditable(True)
        self.cmbNamesROIs.setInsertPolicy(QComboBox.InsertAtCurrent)


    def connectSlotToSignalForROITools(self):
        self.btnDeleteROI.clicked.connect(self.graphicsView.deleteROI)
        self.btnNewROI.clicked.connect(self.graphicsView.newROI)
        self.btnResetROI.clicked.connect(self.graphicsView.resetROI)
        self.btnSaveROI.clicked.connect(self.saveROI)
        self.btnLoad.clicked.connect(self.loadROI)
        self.btnErase.clicked.connect(lambda checked: self.eraseROI(checked))
        self.btnDraw.clicked.connect(lambda checked: self.drawROI(checked))
        self.btnPaint.clicked.connect(lambda checked: self.paintROI(checked))
        self.btnZoom.clicked.connect(lambda checked: self.zoomImage(checked))
        self.cmbNamesROIs.currentIndexChanged.connect(self.loadImageInImageItem)
        self.cmbNamesROIs.editTextChanged.connect(lambda text: self.roiNameChanged(text))


    def roiNameChanged(self, newText):
        try:
            logger.info(&#34;ImageViewerROI.roiNameChanged called&#34;)
            currentIndex = self.cmbNamesROIs.currentIndex()
            #Prevent spaces in new ROI name
            if &#39; &#39; in newText:
                newText = newText.replace(&#34; &#34;, &#34;&#34;)
                self.cmbNamesROIs.setItemText(currentIndex, newText)
                self.cmbNamesROIs.setCurrentText(newText)
            index = self.cmbNamesROIs.findText(newText);
            if index == -1:
                self.cmbNamesROIs.setItemText(currentIndex, newText);
                nameChangedOK = self.graphicsView.dictROIs.renameDictionaryKey(newText)
                if nameChangedOK == False:
                    msgBox = QMessageBox()
                    msgBox.setWindowTitle(&#34;ROI Name Change&#34;)
                    msgBox.setText(&#34;This name is already in use&#34;)
                    msgBox.exec()
                    cmbNamesROIs.setCurrentText(self.graphicsView.dictROIs.prevRegionName)

        except Exception as e:
                print(&#39;Error in ImageViewerROI.roiNameChanged: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.roiNameChanged: &#39; + str(e)) 


    def saveROI(self):
        try:
            # Save Current ROI
            logger.info(&#34;ImageViewerROI.saveROI called&#34;)
            regionName = self.cmbNamesROIs.currentText()
            # get the list of boolean masks for this series
            maskList = self.graphicsView.dictROIs.dictMasks[regionName] 
            # Convert each 2D boolean to 0s and 1s
            maskList = [np.transpose(np.array(mask, dtype=np.int)) for mask in maskList]
            suffix = str(&#34;_ROI_&#34;+ regionName)
            if len(maskList) &gt; 1:
                #inputPath = [i.path for i in self.weasel.images()]
                inputPath = self.imagePathList 
            else:
                inputPath = [self.selectedImagePath]
            # Saving Progress message
            self.weasel.progress_bar(msg=&#34;&lt;H4&gt;Saving ROIs into a new DICOM Series ({} files)&lt;/H4&gt;&#34;.format(len(inputPath)))
            self.weasel.progressBar.set_maximum(len(inputPath))
            (subjectID, studyID, seriesID) = self.weasel.objXMLReader.getImageParentIDs(inputPath[0])
            seriesID = str(int(self.weasel.objXMLReader.getStudy(subjectID, studyID)[-1].attrib[&#39;id&#39;].split(&#39;_&#39;)[0]) + 1)
            seriesUID = SaveDICOM_Image.generateUIDs(ReadDICOM_Image.getDicomDataset(inputPath[0]), seriesID)
            for index, path in enumerate(inputPath):
                self.weasel.progressBar.set_value(index)
                outputPath = SaveDICOM_Image.returnFilePath(path, suffix)
                SaveDICOM_Image.saveNewSingleDicomImage(outputPath, path, maskList[index], suffix, series_id=seriesID, series_uid=seriesUID, parametric_map=&#34;SEG&#34;)
                if &#34;philips&#34; in ReadDICOM_Image.getImageTagValue(outputPath, &#34;Manufacturer&#34;).lower():
                    slope = ReadDICOM_Image.getImageTagValue(outputPath, &#34;RescaleSlope&#34;)
                    SaveDICOM_Image.overwriteDicomFileTag(outputPath, (0x2005, 0x100E), 1/slope) #[(0x2005, 0x100E)]
                self.weasel.objXMLReader.insertNewImageInXMLFile(path, outputPath, suffix)
            self.weasel.progressBar.set_value(len(inputPath))
            self.weasel.progressBar.close()
            self.weasel.refresh()
            QMessageBox.information(self.weasel, &#34;Export ROIs&#34;, &#34;Image Saved&#34;)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.saveROI: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.saveROI: &#39; + str(e)) 


    def loadROI(self):
        try:
            logger.info(&#34;ImageViewerROI.loadROI called&#34;)
            # The following workflow is assumed:
            #   1. The user first loads a series of DICOM images
            #   2. Then the user chooses the series with the mask that will overlay the current viewer.

            # Prompt Windows to select Series
            paramDict = {&#34;Series&#34;:&#34;listview&#34;}
            helpMsg = &#34;Select a Series with ROI&#34;
            #studyID = self.selectedStudy
            study = self.weasel.objXMLReader.getStudy(self.subjectID, self.studyID)
            listSeries = [series.attrib[&#39;id&#39;] for series in study] # if &#39;ROI&#39; in series.attrib[&#39;id&#39;]]
            inputDlg = inputDialog.ParameterInputDialog(paramDict, title= &#34;Load ROI&#34;, helpText=helpMsg, lists=[listSeries])
            listParams = inputDlg.returnListParameterValues()
            if inputDlg.closeInputDialog() == False:
                # for series ID in listParams[0]: # more than 1 ROI may be selected
                seriesID = listParams[0][0] # Temporary, only the first ROI
                imagePathList = self.weasel.objXMLReader.getImagePathList(self.subjectID, self.studyID, seriesID)
                if self.weasel.series != []:
                    #targetPath = [i.path for i in self.weasel.images()]
                    targetPath = self.imagePathList
                else:
                    targetPath = [self.selectedImagePath]
                maskInput = ReadDICOM_Image.returnSeriesPixelArray(imagePathList)
                maskInput[maskInput != 0] = 1
                maskList = [] # Output Mask
                # Consider DICOM Tag SegmentSequence[:].SegmentLabel as some 3rd software do
                if hasattr(ReadDICOM_Image.getDicomDataset(imagePathList[0]), &#34;ContentDescription&#34;):
                    region = ReadDICOM_Image.getSeriesTagValues(imagePathList, &#34;ContentDescription&#34;)[0][0]
                else:
                    region = &#34;new_region_label&#34;
                # Affine re-adjustment
                for index, dicomFile in enumerate(targetPath):
                    self.weasel.progress_bar(msg=&#34;&lt;H4&gt;Loading selected ROI into target image {}&lt;/H4&gt;&#34;.format(index + 1))
                    self.weasel.progressBar.set_maximum(len(targetPath))
                    self.weasel.progressBar.set_value(index + 1)
                    dataset_original = ReadDICOM_Image.getDicomDataset(dicomFile)
                    tempArray = np.zeros(np.shape(ReadDICOM_Image.getPixelArray(dataset_original)))
                    horizontalFlag = None
                    verticalFlag = None
                    for maskFile in imagePathList:
                        dataset = ReadDICOM_Image.getDicomDataset(maskFile)
                        maskArray = ReadDICOM_Image.getPixelArray(dataset)
                        maskArray[maskArray != 0] = 1
                        affineResults = ReadDICOM_Image.mapMaskToImage(maskArray, dataset, dataset_original)
                        if affineResults:
                            try:
                                coords = zip(*affineResults)
                                tempArray[tuple(coords)] = list(np.ones(len(affineResults)).flatten())
                                #if len(np.unique([idx[0] for idx in affineResults])) == 1 and len(np.unique([idx[1] for idx in affineResults])) != 1: horizontalFlag = True
                                #if len(np.unique([idx[1] for idx in affineResults])) == 1 and len(np.unique([idx[0] for idx in affineResults])) != 1: verticalFlag = True
                            except:
                                pass
                    # Will need an Enhanced MRI as example  
                    #if ~hasattr(dataset_original, &#39;PerFrameFunctionalGroupsSequence&#39;):
                        #if horizontalFlag == True:
                            #struct_elm = np.ones((int(dataset_original.SliceThickness / dataset.PixelSpacing[0]), 1)) # Change /2 value here
                            #tempArray = binary_dilation(tempArray, structure=struct_elm).astype(int)
                            #tempArray = binary_closing(tempArray, structure=struct_elm).astype(int)
                        #elif verticalFlag == True:
                            #struct_elm = np.ones((1, int(dataset_original.SliceThickness / dataset.PixelSpacing[1]))) # Change /2 value here
                            #tempArray = binary_dilation(tempArray, structure=struct_elm).astype(int)
                            #tempArray = binary_closing(tempArray, structure=struct_elm).astype(int)
                    maskList.append(tempArray)
                    self.weasel.progressBar.set_value(index+2)
                self.weasel.progressBar.close()

                # Faster approach - 3D and no dilation
                #maskList = np.zeros(np.shape(ReadDICOM_Image.returnSeriesPixelArray(targetPath)))
                #dataset_original = ReadDICOM_Image.getDicomDataset(targetPath)
                #dataset = ReadDICOM_Image.getDicomDataset(imagePathList[0])
                #affineResults = ReadDICOM_Image.mapMaskToImage(maskInput, dataset, dataset_original)
                #if affineResults:
                    #try:
                        #coords = zip(*affineResults)
                        #maskList[tuple(coords)] = list(np.ones(len(affineResults)).flatten())
                    #except:
                        #pass
            
                # First populate the ROI_Storage data structure in a loop
                self.graphicsView.currentROIName = region
                for imageNumber in range(len(maskList)):  #To Do
                    self.graphicsView.currentImageNumber = imageNumber + 1
                    self.graphicsView.dictROIs.addMask(np.array(maskList[imageNumber]).astype(bool))

                # Second populate the dropdown list of region names
                self.cmbNamesROIs.blockSignals(True)
                #remove previous contents of ROI dropdown list
                self.cmbNamesROIs.clear()  
                self.cmbNamesROIs.addItems(self.graphicsView.dictROIs.getListOfRegions())
                self.cmbNamesROIs.blockSignals(False)

                # Redisplay the current image to show the mask
                #mask = graphicsView.dictROIs.getMask(region, 1)
                #graphicsView.graphicsItem.reloadMask(mask)
                self.cmbNamesROIs.setCurrentIndex(self.cmbNamesROIs.count() - 1)
                self.loadImageInImageItem()
        except Exception as e:
                print(&#39;Error in ImageViewerROI.loadROI: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.loadROI: &#39; + str(e)) 


    def eraseROI(self, checked):
        logger.info(&#34;ImageViewerROI.eraseROI called.&#34;)
        if checked:
            self.setButtonsToDefaultStyle(self.btnErase)
            self.btnErase.setStyleSheet(&#34;background-color: red&#34;)
            self.graphicsView.eraseROI()
        else:
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.graphicsItem.eraseEnabled = False
            self.btnErase.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )


    def setButtonsToDefaultStyle(self, thisButton=None):
        logger.info(&#34;DisplayImageDrawRIO.setButtonsToDefaultStyle called&#34;)
        try:
            logger.info(&#34;ImageViewerROI.setButtonsToDefaultStyle called.&#34;)
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.graphicsItem.drawEnabled = False
            self.graphicsView.graphicsItem.eraseEnabled = False
            self.graphicsView.graphicsItem.paintEnabled = False
            if len(self.buttonList) &gt; 0:
                for button in self.buttonList:
                    button.setStyleSheet(
                     &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                     )
                    if button == thisButton:
                            continue
                    button.setChecked(False)
        except Exception as e:
                print(&#39;Error in ImageViewerROI.setButtonsToDefaultStyle: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.setButtonsToDefaultStyle: &#39; + str(e))  


    def drawROI(self, checked):
        logger.info(&#34;ImageViewerROI.drawROI called.&#34;)
        if checked:
            self.setButtonsToDefaultStyle(self.btnDraw)
            self.btnDraw.setStyleSheet(&#34;background-color: red&#34;)
            self.graphicsView.drawROI()
        else:
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.graphicsItem.drawEnabled = False
            self.btnDraw.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )


    def paintROI(self, checked):
        logger.info(&#34;ImageViewerROI.paintROI called.&#34;)
        if checked:
            self.setButtonsToDefaultStyle(self.btnPaint)
            self.btnPaint.setStyleSheet(&#34;background-color: red&#34;)
            self.graphicsView.paintROI()
        else:
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.graphicsItem.paintEnabled = False
            self.btnPaint.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )


    def zoomImage(self, checked):
        logger.info(&#34;ImageViewerROI.zoomImage called.&#34;)
        if checked:
            self.setButtonsToDefaultStyle()
            self.graphicsView.setZoomEnabled(True)
            self.graphicsView.graphicsItem.paintEnabled = False
            self.graphicsView.graphicsItem.drawEnabled = False
            self.graphicsView.graphicsItem.eraseEnabled = False
            self.btnZoom.setStyleSheet(&#34;background-color: red&#34;)
        else:
            QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
            self.graphicsView.setZoomEnabled(False)
            self.btnZoom.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )

    
    def getRoiMeanAndStd(self, mask, pixelArray):
        try:
            logger.info(&#34;ImageViewerROI.getRoiMeanAndStd called&#34;)
            mean = round(np.mean(np.extract(mask, pixelArray)), 1)
            std = round(np.std(np.extract(mask, pixelArray)), 1)
            return mean, std
        except Exception as e:
            print(&#39;Error in ImageViewerROI.getRoiMeanAndStd: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.getRoiMeanAndStd: &#39; + str(e))


    def displayROIMeanAndStd(self):
        try:
            logger.info(&#34;ImageViewerROI.displayROIMeanAndStd called&#34;)
            #print(&#34;ImageViewerROI.displayROIMeanAndStd called&#34;) ##
            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1
            pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
            regionName = self.cmbNamesROIs.currentText()
            mask = self.graphicsView.dictROIs.getMask(regionName, imageNumber)   
            if mask is not None:
                #print(&#34;mask is not none, size={}&#34;.format(len(mask)))##
                mean, std = self.getRoiMeanAndStd(mask, pixelArray)
                #print(&#34;mean ={}, std ={}&#34;.format(mean, std)) ##
                self.roiMeanTxt.setText(&#34;Mean: &#34; + str(mean))
                self.roiStdDevTxt.setText(&#34;SD: &#34; + str(std))
            else:
                self.roiMeanTxt.clear()
                self.roiStdDevTxt.clear()
        except Exception as e:
                print(&#39;Error in ImageViewerROI.displayROIMeanAndStd: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.displayROIMeanAndStd: &#39; + str(e)) 


    def setUpImageEventHandlers(self):
        logger.info(&#34;ImageViewerROI.setUpImageEventHandlers called.&#34;)
        try:
            self.graphicsView.graphicsItem.sigRightMouseDrag.connect(
                lambda deltaX, deltaY: self.adjustLevelsByRightMouseButtonDrag(
                                        deltaX, deltaY))

            self.graphicsView.graphicsItem.sigMouseHovered.connect(
            lambda mouseOverImage:self.getPixelValue(mouseOverImage))

            self.graphicsView.graphicsItem.sigGetDetailsROI.connect(self.updateDetailsROI)

            self.graphicsView.graphicsItem.sigRecalculateMeanROI.connect(self.displayROIMeanAndStd)

            #self.graphicsView.sigContextMenuDisplayed.connect(self.setButtonsToDefaultStyle)
            
            self.graphicsView.sigReloadImage.connect(self.loadImageInImageItem)

            self.graphicsView.sigROIDeleted.connect(self.deleteROITidyUp)

            self.graphicsView.sigSetDrawButtonRed.connect(lambda setRed:
                                                          self.setDrawButtonColour(setRed))

            self.graphicsView.sigSetEraseButtonRed.connect(lambda setRed:
                                                           self.setEraseButtonColour(setRed))

            self.graphicsView.sigSetPaintButtonRed.connect(lambda setRed:
                                                           self.setPaintButtonColour(setRed))

            #self.graphicsView.sigROIChanged.connect(self.setButtonsToDefaultStyle)
            self.graphicsView.sigROIChanged.connect(self.updateROIName)
            self.graphicsView.sigNewROI.connect(lambda newROIName:
                                                self.addNewROItoDropDownList(newROIName))
            self.graphicsView.sigUpdateZoom.connect(lambda increment:
                                                    self.updateZoomSlider(increment))
        except Exception as e:
                print(&#39;Error in ImageViewerROI.setUpImageEventHandlers: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.setUpImageEventHandlers: &#39; + str(e)) 


    def adjustLevelsByRightMouseButtonDrag(self, deltaX, deltaY):
        try:
            self.levelsCompositeComponentLayout.blockLevelsSpinBoxSignals(True)
            centre = self.spinBoxIntensity.value()
            width = self.spinBoxContrast.value()
            if float(centre / np.shape(self.pixelArray)[1]) &gt; 0.01:
                step_y = float(centre / np.shape(self.pixelArray)[1])
            else:
                step_y = 0.01
            if float(width / np.shape(self.pixelArray)[0]) &gt; 0.01:
                step_x = float(width/ np.shape(self.pixelArray)[0])
            else:
                step_x = 0.01
            horizontalDiff = step_y * deltaY
            verticalDiff = step_x * deltaX # Maybe put a minus sign here
            newCentre = centre + horizontalDiff
            newWidth = width + verticalDiff
            self.spinBoxIntensity.setValue(newCentre)
            self.spinBoxContrast.setValue(newWidth)
            self.updateImageLevels()
            self.levelsCompositeComponentLayout.blockLevelsSpinBoxSignals(False)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.adjustLevelsByRightMouseButtonDrag: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.adjustLevelsByRightMouseButtonDrag: &#39; + str(e))

    
    def updateZoomSlider(self, increment):
        &#34;&#34;&#34;This function updates the position of the slider on the image
        zoom slider and calculates the % zoom for display in the label zoomLabel.
        Although, the zoom slider widget is not displayed on the screen,
        this function is a convenient way to keep track of the current image
        zoom value&#34;&#34;&#34;
        try:
            logger.info(&#34;DisplayImageDrawRIO.updateZoomSlider called&#34;)
            self.zoomSlider.blockSignals(True)
            if increment == 0:
                self.zoomSlider.setValue(0)
                self.zoomValueLabel.setText(&#34;&lt;H4&gt;100%&lt;/H4&gt;&#34;)
            else:
                newValue = self.zoomSlider.value() + increment
                newZoomValue = 100 + (newValue * 25)
                self.zoomValueLabel.setText(&#34;&lt;H4&gt;&#34; + str(newZoomValue) + &#34;%&lt;/H4&gt;&#34;)
                if self.zoomSlider.value() &lt; self.zoomSlider.maximum() and increment &gt; 0:
                    self.zoomSlider.setValue(newValue)
                elif self.zoomSlider.value() &gt; self.zoomSlider.minimum() and increment &lt; 0:
                    self.zoomSlider.setValue(newValue)
            self.zoomSlider.blockSignals(False)
        except Exception as e:
                print(&#39;Error in ImageViewerROI.updateZoomSlider: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.updateZoomSlider: &#39; + str(e))


    def addNewROItoDropDownList(self, newRegion):
        logger.info(&#34;ImageViewerROI.addNewROItoDropDownList called.&#34;)
        noDuplicate = True
        for count in range(self.cmbNamesROIs.count()):
             if self.cmbNamesROIs.itemText(count) == newRegion:
                 noDuplicate = False
                 break
        if noDuplicate:
            self.cmbNamesROIs.blockSignals(True)
            self.cmbNamesROIs.addItem(newRegion)
            self.cmbNamesROIs.setCurrentIndex(self.cmbNamesROIs.count() - 1)
            self.cmbNamesROIs.blockSignals(False)


    def updateROIName(self):
        logger.info(&#34;ImageViewerROI.updateROIName called.&#34;)
        self.graphicsView.currentROIName = self.cmbNamesROIs.currentText()

    
    def setUpPixelValueGroupBox(self):
        pixelValueComponent = PixelValueComponent()
        self.lblPixelValue = pixelValueComponent.getLabel()
        self.pixelValueGroupBox = QGroupBox(&#34;Pixel Value&#34;)
        self.pixelValueGroupBox.setFixedHeight(45)
        self.pixelValueGroupBox.setLayout(pixelValueComponent.getLayout()) 


    def setUpZoomGroupBox(self):
        self.zoomValueLabel = QLabel(&#34;&lt;H4&gt;100%&lt;/H4&gt;&#34;)
        self.zoomValueLabel.setStyleSheet(&#34;color:red; padding-left:1; margin-left:1; font-size:8pt;&#34;)
        layout = QHBoxLayout()
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        layout.addWidget(self.zoomValueLabel, alignment = Qt.AlignCenter)
        self.zoomGroupBox = QGroupBox(&#34;Zoom&#34;)
        self.zoomGroupBox.setFixedHeight(45)
        self.zoomGroupBox.setLayout(layout) 


    def getPixelValue(self, mouseOverImage):
        try:
            logger.info(&#34;ImageViewerROI.getPixelValue called&#34;)
            if mouseOverImage:
                xCoord = math.floor(self.graphicsView.graphicsItem.xMouseCoord)
                yCoord = math.floor(self.graphicsView.graphicsItem.yMouseCoord)
                #correct the y coordinate value so that it has a value
                #of 0 at the bottom left corner of the image rather than
                #at the top left corner of the image
                _, nY = self.pixelArray.shape
                correctedYCoord = nY - yCoord
                pixelValue = self.graphicsView.graphicsItem.pixelValue
                strValue = str(pixelValue)
                if self.isSeries:  
                    imageNumber = self.mainImageSlider.value()
                else:
                    imageNumber = 1
                strPosition = &#39; @ X:&#39; + str(xCoord) + &#39;, Y:&#39; + str(correctedYCoord ) + &#39;, Z:&#39; + str(imageNumber)
                self.lblPixelValue.setWordWrap(True)
                self.lblPixelValue.setText(strValue + &#39;\n&#39; + strPosition)
            else:
                 self.lblPixelValue.setText(&#39;&#39;)
        except Exception as e:
                print(&#39;Error in ImageViewerROI.getPixelValue: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.getPixelValue: &#39; + str(e))


    def updateDetailsROI(self):
        logger.info(&#34;ImageViewerROI.updateDetailsROI called&#34;)
        try:
            self.graphicsView.currentROIName = self.cmbNamesROIs.currentText()
            if self.isSeries:  
                self.graphicsView.currentImageNumber = self.mainImageSlider.value()
            else:
                self.graphicsView.currentImageNumber = 1
        except Exception as e:
                print(&#39;Error in ImageViewerROI.updateDetailsROI: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.updateDetailsROI: &#39; + str(e))


    def replaceMask(self):  
        logger.info(&#34;ImageViewerROI.replaceMask called&#34;)
        regionName = self.cmbNamesROIs.currentText()
        if self.isSeries:  
            imageNumber = self.mainImageSlider.value()
        else:
            imageNumber = 1
        mask = self.graphicsView.graphicsItem.getMaskData()
        self.graphicsView.dictROIs.replaceMask(regionName, mask, imageNumber)


    def setUpROIButtons(self):
        try:
            logger.info(&#34;ImageViewerROI.setUpPixelDataWidget called.&#34;)
            self.buttonList = []
            self.setUpROIDropDownList()

            self.btnDeleteROI = QPushButton() 
            self.btnDeleteROI.setToolTip(&#39;Delete the current ROI&#39;)
            self.btnDeleteROI.setIcon(QIcon(QPixmap(DELETE_ICON)))
        
            self.btnNewROI = QPushButton() 
            self.btnNewROI.setToolTip(&#39;Add a new ROI&#39;)
            self.btnNewROI.setIcon(QIcon(QPixmap(NEW_ICON)))

            self.btnResetROI = QPushButton()
            self.btnResetROI.setToolTip(&#39;Clears the ROI from the image&#39;)
            self.btnResetROI.setIcon(QIcon(QPixmap(RESET_ICON)))

            self.btnSaveROI = QPushButton()
            self.btnSaveROI.setToolTip(&#39;Saves the ROI in DICOM format&#39;)
            self.btnSaveROI.setIcon(QIcon(QPixmap(SAVE_ICON)))

            self.btnLoad = QPushButton()
            self.btnLoad.setToolTip(&#39;Loads existing ROIs&#39;)
            self.btnLoad.setIcon(QIcon(QPixmap(LOAD_ICON)))

            self.btnErase = QPushButton()
            self.buttonList.append(self.btnErase)
            self.btnErase.setToolTip(&#34;Erase the ROI. Right click to change eraser size.&#34;)
            self.btnErase.setCheckable(True)
            self.btnErase.setIcon(QIcon(QPixmap(ERASER_CURSOR)))

            self.btnDraw = QPushButton()
            self.buttonList.append(self.btnDraw)
            self.btnDraw.setToolTip(&#34;Draw an ROI&#34;)
            self.btnDraw.setCheckable(True)
            self.btnDraw.setIcon(QIcon(QPixmap(PEN_CURSOR)))

            self.btnPaint = QPushButton()
            self.buttonList.append(self.btnPaint)
            self.btnPaint.setToolTip(&#34;Paint an ROI&#34;)
            self.btnPaint.setCheckable(True)
            self.btnPaint.setIcon(QIcon(QPixmap(BRUSH_CURSOR)))

            self.btnZoom = QPushButton()
            self.buttonList.append(self.btnZoom)
            self.btnZoom.setToolTip(&#34;Zoom In-Left Mouse Button/Zoom Out-Right Mouse Button&#34;)
            self.btnZoom.setCheckable(True)
            self.btnZoom.setIcon(QIcon(QPixmap(MAGNIFYING_GLASS_CURSOR)))

            self.roiMeanTxt = QLabel()
            self.roiMeanTxt.setStyleSheet(&#34;color : red; padding-left:0; margin-left:0; font-size:8pt;&#34;)
            self.roiMeanTxt.setToolTip(&#34;ROI Mean Value&#34;)
            self.roiStdDevTxt = QLabel()
            self.roiStdDevTxt.setStyleSheet(&#34;color : red; padding-left:0; margin-left:0; font-size:8pt;&#34;)
            self.roiStdDevTxt.setToolTip(&#34;ROI Mean Value Standard Deviation&#34;)
            self.connectSlotToSignalForROITools()

            self.roiToolsLayout.addWidget(self.cmbNamesROIs, alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnNewROI, alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnResetROI,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnDeleteROI,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnSaveROI,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnLoad,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnDraw,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnPaint,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnErase, alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.btnZoom,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.roiMeanTxt,  alignment=Qt.AlignLeft)
            self.roiToolsLayout.addWidget(self.roiStdDevTxt,  alignment=Qt.AlignLeft)
        except Exception as e:
               print(&#39;Error in ImageViewerROI.setUpROIButtons: &#39; + str(e))
               logger.exception(&#39;Error in ImageViewerROI.setUpROIButtons: &#39; + str(e)) 

            
    def loadImageInImageItem(self): ###
        try:
            logger.info(&#34;ImageViewerROI.loadImageInImageItem called&#34;)
            self.graphicsView.dictROIs.setPreviousRegionName(self.cmbNamesROIs.currentText())

            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1

            pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
            mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
            self.graphicsView.setImage(self.pixelArray, mask, self.selectedImagePath)
            self.displayROIMeanAndStd()  
            self.setUpImageEventHandlers()
        except Exception as e:
               print(&#39;Error in ImageViewerROI.loadImageInImageItem: &#39; + str(e))
               logger.exception(&#39;Error in ImageViewerROI.loadImageInImageItem: &#39; + str(e))
    

    def deleteROITidyUp(self):
        logger.info(&#34;ImageViewerROI.deleteROITidyUp called&#34;)
        self.loadImageInImageItem() 
        self.displayROIMeanAndStd()
        if self.cmbNamesROIs.currentIndex() == 0 and self.cmbNamesROIs.count() == 1: 
            self.cmbNamesROIs.clear()
            self.cmbNamesROIs.addItem(&#34;region1&#34;)
            self.cmbNamesROIs.setCurrentIndex(0) 
            self.roiMeanTxt.clear()
            self.roiStdDevTxt.clear()
            self.lblPixelValue.clear()
        else:
            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1
            self.cmbNamesROIs.blockSignals(True)
            self.cmbNamesROIs.removeItem(cmbNamesROIs.currentIndex())
            self.cmbNamesROIs.blockSignals(False)
            mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
            self.graphicsView.graphicsItem.reloadMask(mask)


    def setUpImageLevelsLayout(self):
        self.levelsCompositeComponentLayout = imageLevelsSpinBoxes()
        self.imageLevelsGroupBox = QGroupBox()
        self.imageLevelsGroupBox.setFixedHeight(45)
        self.imageLevelsGroupBox.setLayout(self.levelsCompositeComponentLayout.getCompositeComponent())


    def setUpTopRowLayout(self):
        try:
            self.topRowMainLayout = QHBoxLayout()
            
            self.setUpRoiToolsLayout()
            
            self.setUpImageLevelsLayout()

            self.setUpPixelValueGroupBox()

            self.setUpZoomGroupBox()
            
            self.topRowMainLayout.addWidget(self.roiToolsGroupBox)
            self.topRowMainLayout.addWidget(self.imageLevelsGroupBox)
            self.topRowMainLayout.addWidget(self.pixelValueGroupBox)
            self.topRowMainLayout.addWidget(self.zoomGroupBox)

            self.mainVerticalLayout.addLayout(self.topRowMainLayout)

            self.lblImageMissing = QLabel(&#34;&lt;h4&gt;Image Missing&lt;/h4&gt;&#34;)
            self.lblImageMissing.hide()
            self.mainVerticalLayout.addWidget(self.lblImageMissing)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpTopRowLayout: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpTopRowLayout: &#39; + str(e))


    def setUpGraphicsView(self):
        self.graphicsView = GraphicsView(self.numberOfImages)
        self.mainVerticalLayout.addWidget(self.graphicsView) 


    def setUpLevelsSpinBoxes(self):
        try:
            self.spinBoxIntensity, self.spinBoxContrast = self.levelsCompositeComponentLayout.getSpinBoxes() 
            self.spinBoxIntensity.valueChanged.connect(self.updateImageLevels)
            self.spinBoxContrast.valueChanged.connect(self.updateImageLevels)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpLevelsSpinBoxes: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpLevelsSpinBoxes: &#39; + str(e))


    def updateImageLevels(self):
        logger.info(&#34;ImageViewerROI.updateImageLevels called.&#34;)
        try:
            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1
            intensity = self.spinBoxIntensity.value()
            contrast = self.spinBoxContrast.value()
            mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
            self.graphicsView.graphicsItem.updateImageLevels(intensity, contrast, mask)
        except Exception as e:
            print(&#39;Error in ImageViewerROI.updateImageLevels when imageNumber={}: &#39;.format(imageNumber) + str(e))
            logger.exception(&#39;Error in ImageViewerROI.updateImageLevels: &#39; + str(e))


    def setUpImageSliders(self):
        try:
            #create an instance of the ImageSliders class
            self.slidersWidget = imageSliders(self.weasel, 
                                             self.subjectID, 
                                             self.studyID, 
                                             self.seriesID, 
                                             self.imagePathList)

            self.mainVerticalLayout.addLayout(
                    self.slidersWidget.getCustomSliderWidget())

            self.mainImageSlider = self.slidersWidget.getMainSlider()

            #This is how an object created from the ImageSliders class communicates
            #with an object created from the ImageViewerROI class via the former&#39;s
            #sliderMoved event, which passes the image path of the image being viewed
            #to ImageViewerROI&#39;s displayPixelArrayOfSingleImage function for display.
            self.slidersWidget.sliderMoved.connect(lambda imagePath: 
                                                   self.displayPixelArrayOfSingleImage(imagePath))
            #Display the first image in the viewer
            self.slidersWidget.displayFirstImage()
        except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpImageSliders: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpImageSliders: &#39; + str(e))


    def displayPixelArrayOfSingleImage(self, imagePath):
            &#34;&#34;&#34;Displays an image&#39;s pixel array in a pyqtGraph imageView widget 
            &amp; sets its colour table, contrast and intensity levels. 
            Also, sets the contrast and intensity in the associated histogram.
            &#34;&#34;&#34;
            try:
                logger.info(&#34;ImageViewerROI.displayPixelArrayOfSingleImage called&#34;)

                self.selectedImagePath = imagePath
                imageName = os.path.basename(self.selectedImagePath)
                self.pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
                

                self.setWindowTitle(self.subjectID + &#39; - &#39; + self.studyID + &#39; - &#39;+ self.seriesID + &#39; - &#39; 
                         + imageName)

                #Check that pixel array holds an image &amp; display it
                if self.pixelArray is None:
                    self.lblImageMissing.show()
                    self.deleteButton.hide()
                    self.graphicsView.setImage(np.array([[0,0,0],[0,0,0]]))  
                else:
                    self.loadImageInImageItem()
                    self.lblImageMissing.hide()
                    self.setInitialImageLevelValues()

            except Exception as e:
                print(&#39;Error in ImageViewerROI.displayPixelArrayOfSingleImage: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.displayPixelArrayOfSingleImage: &#39; + str(e))


    def setUpZoomSlider(self):
        try:
            self.zoomSlider = Slider(Qt.Vertical)
            self.zoomSlider.setMinimum(0)
            self.zoomSlider.setMaximum(20)
            self.zoomSlider.setSingleStep(1)
            self.zoomSlider.setTickPosition(QSlider.TicksBothSides)
            self.zoomSlider.setTickInterval(1)
            self.zoomSlider.valueChanged.connect(lambda: 
                  self.graphicsView.zoomImage(self.zoomSlider.direction()))
        except Exception as e:
                print(&#39;Error in ImageViewerROI.setUpZoomSlider: &#39; + str(e))
                logger.exception(&#39;Error in ImageViewerROI.setUpZoomSlider: &#39; + str(e))  


    def setEraseButtonColour(self, setRed):
        logger.info(&#34;DisplayImageDrawRIO.setEraseButtonColour called&#34;)
        if setRed:
               self.btnErase.setStyleSheet(&#34;background-color: red&#34;)
               self.btnErase.setChecked(True)
               self.btnPaint.setChecked(False)
               self.btnDraw.setChecked(False)
               self.btnDraw.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
               self.btnPaint.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
        else:
               self.btnErase.setChecked(False)
               self.btnErase.setStyleSheet(
                 &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )


    def setDrawButtonColour(self, setRed):
        logger.info(&#34;DisplayImageDrawRIO.setDrawButtonColour called&#34;)
        if setRed:
               self.btnDraw.setStyleSheet(&#34;background-color: red&#34;)
               self.btnDraw.setChecked(True)
               self.btnPaint.setChecked(False)
               self.btnErase.setChecked(False)
               self.btnPaint.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
               self.btnErase.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
        else:
               self.btnDraw.setChecked(False)
               self.btnDraw.setStyleSheet(
                 &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )


    def setPaintButtonColour(self, setRed):
        logger.info(&#34;DisplayImageDrawRIO.setPaintButtonColour called&#34;)
        if setRed:
               self.btnPaint.setStyleSheet(&#34;background-color: red&#34;)
               self.btnPaint.setChecked(True)
               self.btnDraw.setChecked(False)
               self.btnErase.setChecked(False)
               self.btnDraw.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
               self.btnErase.setStyleSheet(
                &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
        else:
               self.btnPaint.setChecked(False)
               self.btnPaint.setStyleSheet(
                 &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )


    def setInitialImageLevelValues(self):
        self.spinBoxIntensity.blockSignals(True)
        self.spinBoxIntensity.setValue(self.graphicsView.graphicsItem.intensity)
        self.spinBoxIntensity.blockSignals(False)
        self.spinBoxContrast.blockSignals(True)
        self.spinBoxContrast.setValue(self.graphicsView.graphicsItem.contrast)
        self.spinBoxContrast.blockSignals(False)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QMdiSubWindow</li>
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.addNewROItoDropDownList"><code class="name flex">
<span>def <span class="ident">addNewROItoDropDownList</span></span>(<span>self, newRegion)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def addNewROItoDropDownList(self, newRegion):
    logger.info(&#34;ImageViewerROI.addNewROItoDropDownList called.&#34;)
    noDuplicate = True
    for count in range(self.cmbNamesROIs.count()):
         if self.cmbNamesROIs.itemText(count) == newRegion:
             noDuplicate = False
             break
    if noDuplicate:
        self.cmbNamesROIs.blockSignals(True)
        self.cmbNamesROIs.addItem(newRegion)
        self.cmbNamesROIs.setCurrentIndex(self.cmbNamesROIs.count() - 1)
        self.cmbNamesROIs.blockSignals(False)</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.adjustLevelsByRightMouseButtonDrag"><code class="name flex">
<span>def <span class="ident">adjustLevelsByRightMouseButtonDrag</span></span>(<span>self, deltaX, deltaY)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def adjustLevelsByRightMouseButtonDrag(self, deltaX, deltaY):
    try:
        self.levelsCompositeComponentLayout.blockLevelsSpinBoxSignals(True)
        centre = self.spinBoxIntensity.value()
        width = self.spinBoxContrast.value()
        if float(centre / np.shape(self.pixelArray)[1]) &gt; 0.01:
            step_y = float(centre / np.shape(self.pixelArray)[1])
        else:
            step_y = 0.01
        if float(width / np.shape(self.pixelArray)[0]) &gt; 0.01:
            step_x = float(width/ np.shape(self.pixelArray)[0])
        else:
            step_x = 0.01
        horizontalDiff = step_y * deltaY
        verticalDiff = step_x * deltaX # Maybe put a minus sign here
        newCentre = centre + horizontalDiff
        newWidth = width + verticalDiff
        self.spinBoxIntensity.setValue(newCentre)
        self.spinBoxContrast.setValue(newWidth)
        self.updateImageLevels()
        self.levelsCompositeComponentLayout.blockLevelsSpinBoxSignals(False)
    except Exception as e:
        print(&#39;Error in ImageViewerROI.adjustLevelsByRightMouseButtonDrag: &#39; + str(e))
        logger.exception(&#39;Error in ImageViewerROI.adjustLevelsByRightMouseButtonDrag: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.connectSlotToSignalForROITools"><code class="name flex">
<span>def <span class="ident">connectSlotToSignalForROITools</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def connectSlotToSignalForROITools(self):
    self.btnDeleteROI.clicked.connect(self.graphicsView.deleteROI)
    self.btnNewROI.clicked.connect(self.graphicsView.newROI)
    self.btnResetROI.clicked.connect(self.graphicsView.resetROI)
    self.btnSaveROI.clicked.connect(self.saveROI)
    self.btnLoad.clicked.connect(self.loadROI)
    self.btnErase.clicked.connect(lambda checked: self.eraseROI(checked))
    self.btnDraw.clicked.connect(lambda checked: self.drawROI(checked))
    self.btnPaint.clicked.connect(lambda checked: self.paintROI(checked))
    self.btnZoom.clicked.connect(lambda checked: self.zoomImage(checked))
    self.cmbNamesROIs.currentIndexChanged.connect(self.loadImageInImageItem)
    self.cmbNamesROIs.editTextChanged.connect(lambda text: self.roiNameChanged(text))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.deleteROITidyUp"><code class="name flex">
<span>def <span class="ident">deleteROITidyUp</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deleteROITidyUp(self):
    logger.info(&#34;ImageViewerROI.deleteROITidyUp called&#34;)
    self.loadImageInImageItem() 
    self.displayROIMeanAndStd()
    if self.cmbNamesROIs.currentIndex() == 0 and self.cmbNamesROIs.count() == 1: 
        self.cmbNamesROIs.clear()
        self.cmbNamesROIs.addItem(&#34;region1&#34;)
        self.cmbNamesROIs.setCurrentIndex(0) 
        self.roiMeanTxt.clear()
        self.roiStdDevTxt.clear()
        self.lblPixelValue.clear()
    else:
        if self.isSeries:  
            imageNumber = self.mainImageSlider.value()
        else:
            imageNumber = 1
        self.cmbNamesROIs.blockSignals(True)
        self.cmbNamesROIs.removeItem(cmbNamesROIs.currentIndex())
        self.cmbNamesROIs.blockSignals(False)
        mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
        self.graphicsView.graphicsItem.reloadMask(mask)</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.displayPixelArrayOfSingleImage"><code class="name flex">
<span>def <span class="ident">displayPixelArrayOfSingleImage</span></span>(<span>self, imagePath)</span>
</code></dt>
<dd>
<div class="desc"><p>Displays an image's pixel array in a pyqtGraph imageView widget
&amp; sets its colour table, contrast and intensity levels.
Also, sets the contrast and intensity in the associated histogram.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def displayPixelArrayOfSingleImage(self, imagePath):
        &#34;&#34;&#34;Displays an image&#39;s pixel array in a pyqtGraph imageView widget 
        &amp; sets its colour table, contrast and intensity levels. 
        Also, sets the contrast and intensity in the associated histogram.
        &#34;&#34;&#34;
        try:
            logger.info(&#34;ImageViewerROI.displayPixelArrayOfSingleImage called&#34;)

            self.selectedImagePath = imagePath
            imageName = os.path.basename(self.selectedImagePath)
            self.pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
            

            self.setWindowTitle(self.subjectID + &#39; - &#39; + self.studyID + &#39; - &#39;+ self.seriesID + &#39; - &#39; 
                     + imageName)

            #Check that pixel array holds an image &amp; display it
            if self.pixelArray is None:
                self.lblImageMissing.show()
                self.deleteButton.hide()
                self.graphicsView.setImage(np.array([[0,0,0],[0,0,0]]))  
            else:
                self.loadImageInImageItem()
                self.lblImageMissing.hide()
                self.setInitialImageLevelValues()

        except Exception as e:
            print(&#39;Error in ImageViewerROI.displayPixelArrayOfSingleImage: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.displayPixelArrayOfSingleImage: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.displayROIMeanAndStd"><code class="name flex">
<span>def <span class="ident">displayROIMeanAndStd</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def displayROIMeanAndStd(self):
    try:
        logger.info(&#34;ImageViewerROI.displayROIMeanAndStd called&#34;)
        #print(&#34;ImageViewerROI.displayROIMeanAndStd called&#34;) ##
        if self.isSeries:  
            imageNumber = self.mainImageSlider.value()
        else:
            imageNumber = 1
        pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
        regionName = self.cmbNamesROIs.currentText()
        mask = self.graphicsView.dictROIs.getMask(regionName, imageNumber)   
        if mask is not None:
            #print(&#34;mask is not none, size={}&#34;.format(len(mask)))##
            mean, std = self.getRoiMeanAndStd(mask, pixelArray)
            #print(&#34;mean ={}, std ={}&#34;.format(mean, std)) ##
            self.roiMeanTxt.setText(&#34;Mean: &#34; + str(mean))
            self.roiStdDevTxt.setText(&#34;SD: &#34; + str(std))
        else:
            self.roiMeanTxt.clear()
            self.roiStdDevTxt.clear()
    except Exception as e:
            print(&#39;Error in ImageViewerROI.displayROIMeanAndStd: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.displayROIMeanAndStd: &#39; + str(e)) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.drawROI"><code class="name flex">
<span>def <span class="ident">drawROI</span></span>(<span>self, checked)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def drawROI(self, checked):
    logger.info(&#34;ImageViewerROI.drawROI called.&#34;)
    if checked:
        self.setButtonsToDefaultStyle(self.btnDraw)
        self.btnDraw.setStyleSheet(&#34;background-color: red&#34;)
        self.graphicsView.drawROI()
    else:
        QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
        self.graphicsView.graphicsItem.drawEnabled = False
        self.btnDraw.setStyleSheet(
         &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
         )</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.eraseROI"><code class="name flex">
<span>def <span class="ident">eraseROI</span></span>(<span>self, checked)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def eraseROI(self, checked):
    logger.info(&#34;ImageViewerROI.eraseROI called.&#34;)
    if checked:
        self.setButtonsToDefaultStyle(self.btnErase)
        self.btnErase.setStyleSheet(&#34;background-color: red&#34;)
        self.graphicsView.eraseROI()
    else:
        QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
        self.graphicsView.graphicsItem.eraseEnabled = False
        self.btnErase.setStyleSheet(
         &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
         )</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.getPixelValue"><code class="name flex">
<span>def <span class="ident">getPixelValue</span></span>(<span>self, mouseOverImage)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getPixelValue(self, mouseOverImage):
    try:
        logger.info(&#34;ImageViewerROI.getPixelValue called&#34;)
        if mouseOverImage:
            xCoord = math.floor(self.graphicsView.graphicsItem.xMouseCoord)
            yCoord = math.floor(self.graphicsView.graphicsItem.yMouseCoord)
            #correct the y coordinate value so that it has a value
            #of 0 at the bottom left corner of the image rather than
            #at the top left corner of the image
            _, nY = self.pixelArray.shape
            correctedYCoord = nY - yCoord
            pixelValue = self.graphicsView.graphicsItem.pixelValue
            strValue = str(pixelValue)
            if self.isSeries:  
                imageNumber = self.mainImageSlider.value()
            else:
                imageNumber = 1
            strPosition = &#39; @ X:&#39; + str(xCoord) + &#39;, Y:&#39; + str(correctedYCoord ) + &#39;, Z:&#39; + str(imageNumber)
            self.lblPixelValue.setWordWrap(True)
            self.lblPixelValue.setText(strValue + &#39;\n&#39; + strPosition)
        else:
             self.lblPixelValue.setText(&#39;&#39;)
    except Exception as e:
            print(&#39;Error in ImageViewerROI.getPixelValue: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.getPixelValue: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.getRoiMeanAndStd"><code class="name flex">
<span>def <span class="ident">getRoiMeanAndStd</span></span>(<span>self, mask, pixelArray)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getRoiMeanAndStd(self, mask, pixelArray):
    try:
        logger.info(&#34;ImageViewerROI.getRoiMeanAndStd called&#34;)
        mean = round(np.mean(np.extract(mask, pixelArray)), 1)
        std = round(np.std(np.extract(mask, pixelArray)), 1)
        return mean, std
    except Exception as e:
        print(&#39;Error in ImageViewerROI.getRoiMeanAndStd: &#39; + str(e))
        logger.exception(&#39;Error in ImageViewerROI.getRoiMeanAndStd: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.loadImageInImageItem"><code class="name flex">
<span>def <span class="ident">loadImageInImageItem</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def loadImageInImageItem(self): ###
    try:
        logger.info(&#34;ImageViewerROI.loadImageInImageItem called&#34;)
        self.graphicsView.dictROIs.setPreviousRegionName(self.cmbNamesROIs.currentText())

        if self.isSeries:  
            imageNumber = self.mainImageSlider.value()
        else:
            imageNumber = 1

        pixelArray = ReadDICOM_Image.returnPixelArray(self.selectedImagePath)
        mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
        self.graphicsView.setImage(self.pixelArray, mask, self.selectedImagePath)
        self.displayROIMeanAndStd()  
        self.setUpImageEventHandlers()
    except Exception as e:
           print(&#39;Error in ImageViewerROI.loadImageInImageItem: &#39; + str(e))
           logger.exception(&#39;Error in ImageViewerROI.loadImageInImageItem: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.loadROI"><code class="name flex">
<span>def <span class="ident">loadROI</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def loadROI(self):
    try:
        logger.info(&#34;ImageViewerROI.loadROI called&#34;)
        # The following workflow is assumed:
        #   1. The user first loads a series of DICOM images
        #   2. Then the user chooses the series with the mask that will overlay the current viewer.

        # Prompt Windows to select Series
        paramDict = {&#34;Series&#34;:&#34;listview&#34;}
        helpMsg = &#34;Select a Series with ROI&#34;
        #studyID = self.selectedStudy
        study = self.weasel.objXMLReader.getStudy(self.subjectID, self.studyID)
        listSeries = [series.attrib[&#39;id&#39;] for series in study] # if &#39;ROI&#39; in series.attrib[&#39;id&#39;]]
        inputDlg = inputDialog.ParameterInputDialog(paramDict, title= &#34;Load ROI&#34;, helpText=helpMsg, lists=[listSeries])
        listParams = inputDlg.returnListParameterValues()
        if inputDlg.closeInputDialog() == False:
            # for series ID in listParams[0]: # more than 1 ROI may be selected
            seriesID = listParams[0][0] # Temporary, only the first ROI
            imagePathList = self.weasel.objXMLReader.getImagePathList(self.subjectID, self.studyID, seriesID)
            if self.weasel.series != []:
                #targetPath = [i.path for i in self.weasel.images()]
                targetPath = self.imagePathList
            else:
                targetPath = [self.selectedImagePath]
            maskInput = ReadDICOM_Image.returnSeriesPixelArray(imagePathList)
            maskInput[maskInput != 0] = 1
            maskList = [] # Output Mask
            # Consider DICOM Tag SegmentSequence[:].SegmentLabel as some 3rd software do
            if hasattr(ReadDICOM_Image.getDicomDataset(imagePathList[0]), &#34;ContentDescription&#34;):
                region = ReadDICOM_Image.getSeriesTagValues(imagePathList, &#34;ContentDescription&#34;)[0][0]
            else:
                region = &#34;new_region_label&#34;
            # Affine re-adjustment
            for index, dicomFile in enumerate(targetPath):
                self.weasel.progress_bar(msg=&#34;&lt;H4&gt;Loading selected ROI into target image {}&lt;/H4&gt;&#34;.format(index + 1))
                self.weasel.progressBar.set_maximum(len(targetPath))
                self.weasel.progressBar.set_value(index + 1)
                dataset_original = ReadDICOM_Image.getDicomDataset(dicomFile)
                tempArray = np.zeros(np.shape(ReadDICOM_Image.getPixelArray(dataset_original)))
                horizontalFlag = None
                verticalFlag = None
                for maskFile in imagePathList:
                    dataset = ReadDICOM_Image.getDicomDataset(maskFile)
                    maskArray = ReadDICOM_Image.getPixelArray(dataset)
                    maskArray[maskArray != 0] = 1
                    affineResults = ReadDICOM_Image.mapMaskToImage(maskArray, dataset, dataset_original)
                    if affineResults:
                        try:
                            coords = zip(*affineResults)
                            tempArray[tuple(coords)] = list(np.ones(len(affineResults)).flatten())
                            #if len(np.unique([idx[0] for idx in affineResults])) == 1 and len(np.unique([idx[1] for idx in affineResults])) != 1: horizontalFlag = True
                            #if len(np.unique([idx[1] for idx in affineResults])) == 1 and len(np.unique([idx[0] for idx in affineResults])) != 1: verticalFlag = True
                        except:
                            pass
                # Will need an Enhanced MRI as example  
                #if ~hasattr(dataset_original, &#39;PerFrameFunctionalGroupsSequence&#39;):
                    #if horizontalFlag == True:
                        #struct_elm = np.ones((int(dataset_original.SliceThickness / dataset.PixelSpacing[0]), 1)) # Change /2 value here
                        #tempArray = binary_dilation(tempArray, structure=struct_elm).astype(int)
                        #tempArray = binary_closing(tempArray, structure=struct_elm).astype(int)
                    #elif verticalFlag == True:
                        #struct_elm = np.ones((1, int(dataset_original.SliceThickness / dataset.PixelSpacing[1]))) # Change /2 value here
                        #tempArray = binary_dilation(tempArray, structure=struct_elm).astype(int)
                        #tempArray = binary_closing(tempArray, structure=struct_elm).astype(int)
                maskList.append(tempArray)
                self.weasel.progressBar.set_value(index+2)
            self.weasel.progressBar.close()

            # Faster approach - 3D and no dilation
            #maskList = np.zeros(np.shape(ReadDICOM_Image.returnSeriesPixelArray(targetPath)))
            #dataset_original = ReadDICOM_Image.getDicomDataset(targetPath)
            #dataset = ReadDICOM_Image.getDicomDataset(imagePathList[0])
            #affineResults = ReadDICOM_Image.mapMaskToImage(maskInput, dataset, dataset_original)
            #if affineResults:
                #try:
                    #coords = zip(*affineResults)
                    #maskList[tuple(coords)] = list(np.ones(len(affineResults)).flatten())
                #except:
                    #pass
        
            # First populate the ROI_Storage data structure in a loop
            self.graphicsView.currentROIName = region
            for imageNumber in range(len(maskList)):  #To Do
                self.graphicsView.currentImageNumber = imageNumber + 1
                self.graphicsView.dictROIs.addMask(np.array(maskList[imageNumber]).astype(bool))

            # Second populate the dropdown list of region names
            self.cmbNamesROIs.blockSignals(True)
            #remove previous contents of ROI dropdown list
            self.cmbNamesROIs.clear()  
            self.cmbNamesROIs.addItems(self.graphicsView.dictROIs.getListOfRegions())
            self.cmbNamesROIs.blockSignals(False)

            # Redisplay the current image to show the mask
            #mask = graphicsView.dictROIs.getMask(region, 1)
            #graphicsView.graphicsItem.reloadMask(mask)
            self.cmbNamesROIs.setCurrentIndex(self.cmbNamesROIs.count() - 1)
            self.loadImageInImageItem()
    except Exception as e:
            print(&#39;Error in ImageViewerROI.loadROI: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.loadROI: &#39; + str(e)) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.paintROI"><code class="name flex">
<span>def <span class="ident">paintROI</span></span>(<span>self, checked)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def paintROI(self, checked):
    logger.info(&#34;ImageViewerROI.paintROI called.&#34;)
    if checked:
        self.setButtonsToDefaultStyle(self.btnPaint)
        self.btnPaint.setStyleSheet(&#34;background-color: red&#34;)
        self.graphicsView.paintROI()
    else:
        QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
        self.graphicsView.graphicsItem.paintEnabled = False
        self.btnPaint.setStyleSheet(
         &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
         )</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.replaceMask"><code class="name flex">
<span>def <span class="ident">replaceMask</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def replaceMask(self):  
    logger.info(&#34;ImageViewerROI.replaceMask called&#34;)
    regionName = self.cmbNamesROIs.currentText()
    if self.isSeries:  
        imageNumber = self.mainImageSlider.value()
    else:
        imageNumber = 1
    mask = self.graphicsView.graphicsItem.getMaskData()
    self.graphicsView.dictROIs.replaceMask(regionName, mask, imageNumber)</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.roiNameChanged"><code class="name flex">
<span>def <span class="ident">roiNameChanged</span></span>(<span>self, newText)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def roiNameChanged(self, newText):
    try:
        logger.info(&#34;ImageViewerROI.roiNameChanged called&#34;)
        currentIndex = self.cmbNamesROIs.currentIndex()
        #Prevent spaces in new ROI name
        if &#39; &#39; in newText:
            newText = newText.replace(&#34; &#34;, &#34;&#34;)
            self.cmbNamesROIs.setItemText(currentIndex, newText)
            self.cmbNamesROIs.setCurrentText(newText)
        index = self.cmbNamesROIs.findText(newText);
        if index == -1:
            self.cmbNamesROIs.setItemText(currentIndex, newText);
            nameChangedOK = self.graphicsView.dictROIs.renameDictionaryKey(newText)
            if nameChangedOK == False:
                msgBox = QMessageBox()
                msgBox.setWindowTitle(&#34;ROI Name Change&#34;)
                msgBox.setText(&#34;This name is already in use&#34;)
                msgBox.exec()
                cmbNamesROIs.setCurrentText(self.graphicsView.dictROIs.prevRegionName)

    except Exception as e:
            print(&#39;Error in ImageViewerROI.roiNameChanged: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.roiNameChanged: &#39; + str(e)) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.saveROI"><code class="name flex">
<span>def <span class="ident">saveROI</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def saveROI(self):
    try:
        # Save Current ROI
        logger.info(&#34;ImageViewerROI.saveROI called&#34;)
        regionName = self.cmbNamesROIs.currentText()
        # get the list of boolean masks for this series
        maskList = self.graphicsView.dictROIs.dictMasks[regionName] 
        # Convert each 2D boolean to 0s and 1s
        maskList = [np.transpose(np.array(mask, dtype=np.int)) for mask in maskList]
        suffix = str(&#34;_ROI_&#34;+ regionName)
        if len(maskList) &gt; 1:
            #inputPath = [i.path for i in self.weasel.images()]
            inputPath = self.imagePathList 
        else:
            inputPath = [self.selectedImagePath]
        # Saving Progress message
        self.weasel.progress_bar(msg=&#34;&lt;H4&gt;Saving ROIs into a new DICOM Series ({} files)&lt;/H4&gt;&#34;.format(len(inputPath)))
        self.weasel.progressBar.set_maximum(len(inputPath))
        (subjectID, studyID, seriesID) = self.weasel.objXMLReader.getImageParentIDs(inputPath[0])
        seriesID = str(int(self.weasel.objXMLReader.getStudy(subjectID, studyID)[-1].attrib[&#39;id&#39;].split(&#39;_&#39;)[0]) + 1)
        seriesUID = SaveDICOM_Image.generateUIDs(ReadDICOM_Image.getDicomDataset(inputPath[0]), seriesID)
        for index, path in enumerate(inputPath):
            self.weasel.progressBar.set_value(index)
            outputPath = SaveDICOM_Image.returnFilePath(path, suffix)
            SaveDICOM_Image.saveNewSingleDicomImage(outputPath, path, maskList[index], suffix, series_id=seriesID, series_uid=seriesUID, parametric_map=&#34;SEG&#34;)
            if &#34;philips&#34; in ReadDICOM_Image.getImageTagValue(outputPath, &#34;Manufacturer&#34;).lower():
                slope = ReadDICOM_Image.getImageTagValue(outputPath, &#34;RescaleSlope&#34;)
                SaveDICOM_Image.overwriteDicomFileTag(outputPath, (0x2005, 0x100E), 1/slope) #[(0x2005, 0x100E)]
            self.weasel.objXMLReader.insertNewImageInXMLFile(path, outputPath, suffix)
        self.weasel.progressBar.set_value(len(inputPath))
        self.weasel.progressBar.close()
        self.weasel.refresh()
        QMessageBox.information(self.weasel, &#34;Export ROIs&#34;, &#34;Image Saved&#34;)
    except Exception as e:
        print(&#39;Error in ImageViewerROI.saveROI: &#39; + str(e))
        logger.exception(&#39;Error in ImageViewerROI.saveROI: &#39; + str(e)) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setButtonsToDefaultStyle"><code class="name flex">
<span>def <span class="ident">setButtonsToDefaultStyle</span></span>(<span>self, thisButton=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setButtonsToDefaultStyle(self, thisButton=None):
    logger.info(&#34;DisplayImageDrawRIO.setButtonsToDefaultStyle called&#34;)
    try:
        logger.info(&#34;ImageViewerROI.setButtonsToDefaultStyle called.&#34;)
        QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
        self.graphicsView.graphicsItem.drawEnabled = False
        self.graphicsView.graphicsItem.eraseEnabled = False
        self.graphicsView.graphicsItem.paintEnabled = False
        if len(self.buttonList) &gt; 0:
            for button in self.buttonList:
                button.setStyleSheet(
                 &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
                 )
                if button == thisButton:
                        continue
                button.setChecked(False)
    except Exception as e:
            print(&#39;Error in ImageViewerROI.setButtonsToDefaultStyle: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setButtonsToDefaultStyle: &#39; + str(e))  </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setDrawButtonColour"><code class="name flex">
<span>def <span class="ident">setDrawButtonColour</span></span>(<span>self, setRed)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setDrawButtonColour(self, setRed):
    logger.info(&#34;DisplayImageDrawRIO.setDrawButtonColour called&#34;)
    if setRed:
           self.btnDraw.setStyleSheet(&#34;background-color: red&#34;)
           self.btnDraw.setChecked(True)
           self.btnPaint.setChecked(False)
           self.btnErase.setChecked(False)
           self.btnPaint.setStyleSheet(
            &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )
           self.btnErase.setStyleSheet(
            &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )
    else:
           self.btnDraw.setChecked(False)
           self.btnDraw.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setEraseButtonColour"><code class="name flex">
<span>def <span class="ident">setEraseButtonColour</span></span>(<span>self, setRed)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setEraseButtonColour(self, setRed):
    logger.info(&#34;DisplayImageDrawRIO.setEraseButtonColour called&#34;)
    if setRed:
           self.btnErase.setStyleSheet(&#34;background-color: red&#34;)
           self.btnErase.setChecked(True)
           self.btnPaint.setChecked(False)
           self.btnDraw.setChecked(False)
           self.btnDraw.setStyleSheet(
            &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )
           self.btnPaint.setStyleSheet(
            &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )
    else:
           self.btnErase.setChecked(False)
           self.btnErase.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setInitialImageLevelValues"><code class="name flex">
<span>def <span class="ident">setInitialImageLevelValues</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setInitialImageLevelValues(self):
    self.spinBoxIntensity.blockSignals(True)
    self.spinBoxIntensity.setValue(self.graphicsView.graphicsItem.intensity)
    self.spinBoxIntensity.blockSignals(False)
    self.spinBoxContrast.blockSignals(True)
    self.spinBoxContrast.setValue(self.graphicsView.graphicsItem.contrast)
    self.spinBoxContrast.blockSignals(False)</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setPaintButtonColour"><code class="name flex">
<span>def <span class="ident">setPaintButtonColour</span></span>(<span>self, setRed)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setPaintButtonColour(self, setRed):
    logger.info(&#34;DisplayImageDrawRIO.setPaintButtonColour called&#34;)
    if setRed:
           self.btnPaint.setStyleSheet(&#34;background-color: red&#34;)
           self.btnPaint.setChecked(True)
           self.btnDraw.setChecked(False)
           self.btnErase.setChecked(False)
           self.btnDraw.setStyleSheet(
            &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )
           self.btnErase.setStyleSheet(
            &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )
    else:
           self.btnPaint.setChecked(False)
           self.btnPaint.setStyleSheet(
             &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
             )</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpGraphicsView"><code class="name flex">
<span>def <span class="ident">setUpGraphicsView</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpGraphicsView(self):
    self.graphicsView = GraphicsView(self.numberOfImages)
    self.mainVerticalLayout.addWidget(self.graphicsView) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageEventHandlers"><code class="name flex">
<span>def <span class="ident">setUpImageEventHandlers</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpImageEventHandlers(self):
    logger.info(&#34;ImageViewerROI.setUpImageEventHandlers called.&#34;)
    try:
        self.graphicsView.graphicsItem.sigRightMouseDrag.connect(
            lambda deltaX, deltaY: self.adjustLevelsByRightMouseButtonDrag(
                                    deltaX, deltaY))

        self.graphicsView.graphicsItem.sigMouseHovered.connect(
        lambda mouseOverImage:self.getPixelValue(mouseOverImage))

        self.graphicsView.graphicsItem.sigGetDetailsROI.connect(self.updateDetailsROI)

        self.graphicsView.graphicsItem.sigRecalculateMeanROI.connect(self.displayROIMeanAndStd)

        #self.graphicsView.sigContextMenuDisplayed.connect(self.setButtonsToDefaultStyle)
        
        self.graphicsView.sigReloadImage.connect(self.loadImageInImageItem)

        self.graphicsView.sigROIDeleted.connect(self.deleteROITidyUp)

        self.graphicsView.sigSetDrawButtonRed.connect(lambda setRed:
                                                      self.setDrawButtonColour(setRed))

        self.graphicsView.sigSetEraseButtonRed.connect(lambda setRed:
                                                       self.setEraseButtonColour(setRed))

        self.graphicsView.sigSetPaintButtonRed.connect(lambda setRed:
                                                       self.setPaintButtonColour(setRed))

        #self.graphicsView.sigROIChanged.connect(self.setButtonsToDefaultStyle)
        self.graphicsView.sigROIChanged.connect(self.updateROIName)
        self.graphicsView.sigNewROI.connect(lambda newROIName:
                                            self.addNewROItoDropDownList(newROIName))
        self.graphicsView.sigUpdateZoom.connect(lambda increment:
                                                self.updateZoomSlider(increment))
    except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpImageEventHandlers: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpImageEventHandlers: &#39; + str(e)) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageLevelsLayout"><code class="name flex">
<span>def <span class="ident">setUpImageLevelsLayout</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpImageLevelsLayout(self):
    self.levelsCompositeComponentLayout = imageLevelsSpinBoxes()
    self.imageLevelsGroupBox = QGroupBox()
    self.imageLevelsGroupBox.setFixedHeight(45)
    self.imageLevelsGroupBox.setLayout(self.levelsCompositeComponentLayout.getCompositeComponent())</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageSliders"><code class="name flex">
<span>def <span class="ident">setUpImageSliders</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpImageSliders(self):
    try:
        #create an instance of the ImageSliders class
        self.slidersWidget = imageSliders(self.weasel, 
                                         self.subjectID, 
                                         self.studyID, 
                                         self.seriesID, 
                                         self.imagePathList)

        self.mainVerticalLayout.addLayout(
                self.slidersWidget.getCustomSliderWidget())

        self.mainImageSlider = self.slidersWidget.getMainSlider()

        #This is how an object created from the ImageSliders class communicates
        #with an object created from the ImageViewerROI class via the former&#39;s
        #sliderMoved event, which passes the image path of the image being viewed
        #to ImageViewerROI&#39;s displayPixelArrayOfSingleImage function for display.
        self.slidersWidget.sliderMoved.connect(lambda imagePath: 
                                               self.displayPixelArrayOfSingleImage(imagePath))
        #Display the first image in the viewer
        self.slidersWidget.displayFirstImage()
    except Exception as e:
        print(&#39;Error in ImageViewerROI.setUpImageSliders: &#39; + str(e))
        logger.exception(&#39;Error in ImageViewerROI.setUpImageSliders: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpLevelsSpinBoxes"><code class="name flex">
<span>def <span class="ident">setUpLevelsSpinBoxes</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpLevelsSpinBoxes(self):
    try:
        self.spinBoxIntensity, self.spinBoxContrast = self.levelsCompositeComponentLayout.getSpinBoxes() 
        self.spinBoxIntensity.valueChanged.connect(self.updateImageLevels)
        self.spinBoxContrast.valueChanged.connect(self.updateImageLevels)
    except Exception as e:
        print(&#39;Error in ImageViewerROI.setUpLevelsSpinBoxes: &#39; + str(e))
        logger.exception(&#39;Error in ImageViewerROI.setUpLevelsSpinBoxes: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpMainLayout"><code class="name flex">
<span>def <span class="ident">setUpMainLayout</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpMainLayout(self):
    try:
        self.mainVerticalLayout = QVBoxLayout()
        self.widget = QWidget()
        self.widget.setLayout(self.mainVerticalLayout)
        self.setWidget(self.widget)
    except Exception as e:
        print(&#39;Error in ImageViewerROI.setUpMainLayout: &#39; + str(e))
        logger.exception(&#39;Error in ImageViewerROI.setUpMainLayout: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpPixelValueGroupBox"><code class="name flex">
<span>def <span class="ident">setUpPixelValueGroupBox</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpPixelValueGroupBox(self):
    pixelValueComponent = PixelValueComponent()
    self.lblPixelValue = pixelValueComponent.getLabel()
    self.pixelValueGroupBox = QGroupBox(&#34;Pixel Value&#34;)
    self.pixelValueGroupBox.setFixedHeight(45)
    self.pixelValueGroupBox.setLayout(pixelValueComponent.getLayout()) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpROIButtons"><code class="name flex">
<span>def <span class="ident">setUpROIButtons</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpROIButtons(self):
    try:
        logger.info(&#34;ImageViewerROI.setUpPixelDataWidget called.&#34;)
        self.buttonList = []
        self.setUpROIDropDownList()

        self.btnDeleteROI = QPushButton() 
        self.btnDeleteROI.setToolTip(&#39;Delete the current ROI&#39;)
        self.btnDeleteROI.setIcon(QIcon(QPixmap(DELETE_ICON)))
    
        self.btnNewROI = QPushButton() 
        self.btnNewROI.setToolTip(&#39;Add a new ROI&#39;)
        self.btnNewROI.setIcon(QIcon(QPixmap(NEW_ICON)))

        self.btnResetROI = QPushButton()
        self.btnResetROI.setToolTip(&#39;Clears the ROI from the image&#39;)
        self.btnResetROI.setIcon(QIcon(QPixmap(RESET_ICON)))

        self.btnSaveROI = QPushButton()
        self.btnSaveROI.setToolTip(&#39;Saves the ROI in DICOM format&#39;)
        self.btnSaveROI.setIcon(QIcon(QPixmap(SAVE_ICON)))

        self.btnLoad = QPushButton()
        self.btnLoad.setToolTip(&#39;Loads existing ROIs&#39;)
        self.btnLoad.setIcon(QIcon(QPixmap(LOAD_ICON)))

        self.btnErase = QPushButton()
        self.buttonList.append(self.btnErase)
        self.btnErase.setToolTip(&#34;Erase the ROI. Right click to change eraser size.&#34;)
        self.btnErase.setCheckable(True)
        self.btnErase.setIcon(QIcon(QPixmap(ERASER_CURSOR)))

        self.btnDraw = QPushButton()
        self.buttonList.append(self.btnDraw)
        self.btnDraw.setToolTip(&#34;Draw an ROI&#34;)
        self.btnDraw.setCheckable(True)
        self.btnDraw.setIcon(QIcon(QPixmap(PEN_CURSOR)))

        self.btnPaint = QPushButton()
        self.buttonList.append(self.btnPaint)
        self.btnPaint.setToolTip(&#34;Paint an ROI&#34;)
        self.btnPaint.setCheckable(True)
        self.btnPaint.setIcon(QIcon(QPixmap(BRUSH_CURSOR)))

        self.btnZoom = QPushButton()
        self.buttonList.append(self.btnZoom)
        self.btnZoom.setToolTip(&#34;Zoom In-Left Mouse Button/Zoom Out-Right Mouse Button&#34;)
        self.btnZoom.setCheckable(True)
        self.btnZoom.setIcon(QIcon(QPixmap(MAGNIFYING_GLASS_CURSOR)))

        self.roiMeanTxt = QLabel()
        self.roiMeanTxt.setStyleSheet(&#34;color : red; padding-left:0; margin-left:0; font-size:8pt;&#34;)
        self.roiMeanTxt.setToolTip(&#34;ROI Mean Value&#34;)
        self.roiStdDevTxt = QLabel()
        self.roiStdDevTxt.setStyleSheet(&#34;color : red; padding-left:0; margin-left:0; font-size:8pt;&#34;)
        self.roiStdDevTxt.setToolTip(&#34;ROI Mean Value Standard Deviation&#34;)
        self.connectSlotToSignalForROITools()

        self.roiToolsLayout.addWidget(self.cmbNamesROIs, alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnNewROI, alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnResetROI,  alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnDeleteROI,  alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnSaveROI,  alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnLoad,  alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnDraw,  alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnPaint,  alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnErase, alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.btnZoom,  alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.roiMeanTxt,  alignment=Qt.AlignLeft)
        self.roiToolsLayout.addWidget(self.roiStdDevTxt,  alignment=Qt.AlignLeft)
    except Exception as e:
           print(&#39;Error in ImageViewerROI.setUpROIButtons: &#39; + str(e))
           logger.exception(&#39;Error in ImageViewerROI.setUpROIButtons: &#39; + str(e)) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpROIDropDownList"><code class="name flex">
<span>def <span class="ident">setUpROIDropDownList</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpROIDropDownList(self):
    self.cmbNamesROIs = QComboBox()
    self.cmbNamesROIs.setDuplicatesEnabled(False)
    self.cmbNamesROIs.addItem(&#34;region1&#34;)
    self.cmbNamesROIs.setSizeAdjustPolicy(QComboBox.AdjustToContents)
    self.graphicsView.currentROIName = &#34;region1&#34;
    self.cmbNamesROIs.setCurrentIndex(0)
    self.cmbNamesROIs.setStyleSheet(&#39;QComboBox {font: 11pt Arial}&#39;)
    self.cmbNamesROIs.setToolTip(&#34;Displays a list of ROIs created&#34;)
    self.cmbNamesROIs.setEditable(True)
    self.cmbNamesROIs.setInsertPolicy(QComboBox.InsertAtCurrent)</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpRoiToolsLayout"><code class="name flex">
<span>def <span class="ident">setUpRoiToolsLayout</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpRoiToolsLayout(self):
    self.roiToolsLayout = QHBoxLayout()
    self.roiToolsLayout.setContentsMargins(0, 0, 0, 0)
    self.roiToolsLayout.setSpacing(0)
    self.roiToolsGroupBox = QGroupBox()
    self.roiToolsGroupBox.setFixedHeight(45)
    self.roiToolsGroupBox.setLayout(self.roiToolsLayout)</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpTopRowLayout"><code class="name flex">
<span>def <span class="ident">setUpTopRowLayout</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpTopRowLayout(self):
    try:
        self.topRowMainLayout = QHBoxLayout()
        
        self.setUpRoiToolsLayout()
        
        self.setUpImageLevelsLayout()

        self.setUpPixelValueGroupBox()

        self.setUpZoomGroupBox()
        
        self.topRowMainLayout.addWidget(self.roiToolsGroupBox)
        self.topRowMainLayout.addWidget(self.imageLevelsGroupBox)
        self.topRowMainLayout.addWidget(self.pixelValueGroupBox)
        self.topRowMainLayout.addWidget(self.zoomGroupBox)

        self.mainVerticalLayout.addLayout(self.topRowMainLayout)

        self.lblImageMissing = QLabel(&#34;&lt;h4&gt;Image Missing&lt;/h4&gt;&#34;)
        self.lblImageMissing.hide()
        self.mainVerticalLayout.addWidget(self.lblImageMissing)
    except Exception as e:
        print(&#39;Error in ImageViewerROI.setUpTopRowLayout: &#39; + str(e))
        logger.exception(&#39;Error in ImageViewerROI.setUpTopRowLayout: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpZoomGroupBox"><code class="name flex">
<span>def <span class="ident">setUpZoomGroupBox</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpZoomGroupBox(self):
    self.zoomValueLabel = QLabel(&#34;&lt;H4&gt;100%&lt;/H4&gt;&#34;)
    self.zoomValueLabel.setStyleSheet(&#34;color:red; padding-left:1; margin-left:1; font-size:8pt;&#34;)
    layout = QHBoxLayout()
    layout.setContentsMargins(0, 0, 0, 0)
    layout.setSpacing(0)
    layout.addWidget(self.zoomValueLabel, alignment = Qt.AlignCenter)
    self.zoomGroupBox = QGroupBox(&#34;Zoom&#34;)
    self.zoomGroupBox.setFixedHeight(45)
    self.zoomGroupBox.setLayout(layout) </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpZoomSlider"><code class="name flex">
<span>def <span class="ident">setUpZoomSlider</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setUpZoomSlider(self):
    try:
        self.zoomSlider = Slider(Qt.Vertical)
        self.zoomSlider.setMinimum(0)
        self.zoomSlider.setMaximum(20)
        self.zoomSlider.setSingleStep(1)
        self.zoomSlider.setTickPosition(QSlider.TicksBothSides)
        self.zoomSlider.setTickInterval(1)
        self.zoomSlider.valueChanged.connect(lambda: 
              self.graphicsView.zoomImage(self.zoomSlider.direction()))
    except Exception as e:
            print(&#39;Error in ImageViewerROI.setUpZoomSlider: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.setUpZoomSlider: &#39; + str(e))  </code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateDetailsROI"><code class="name flex">
<span>def <span class="ident">updateDetailsROI</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def updateDetailsROI(self):
    logger.info(&#34;ImageViewerROI.updateDetailsROI called&#34;)
    try:
        self.graphicsView.currentROIName = self.cmbNamesROIs.currentText()
        if self.isSeries:  
            self.graphicsView.currentImageNumber = self.mainImageSlider.value()
        else:
            self.graphicsView.currentImageNumber = 1
    except Exception as e:
            print(&#39;Error in ImageViewerROI.updateDetailsROI: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.updateDetailsROI: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateImageLevels"><code class="name flex">
<span>def <span class="ident">updateImageLevels</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def updateImageLevels(self):
    logger.info(&#34;ImageViewerROI.updateImageLevels called.&#34;)
    try:
        if self.isSeries:  
            imageNumber = self.mainImageSlider.value()
        else:
            imageNumber = 1
        intensity = self.spinBoxIntensity.value()
        contrast = self.spinBoxContrast.value()
        mask = self.graphicsView.dictROIs.getMask(self.cmbNamesROIs.currentText(), imageNumber)
        self.graphicsView.graphicsItem.updateImageLevels(intensity, contrast, mask)
    except Exception as e:
        print(&#39;Error in ImageViewerROI.updateImageLevels when imageNumber={}: &#39;.format(imageNumber) + str(e))
        logger.exception(&#39;Error in ImageViewerROI.updateImageLevels: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateROIName"><code class="name flex">
<span>def <span class="ident">updateROIName</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def updateROIName(self):
    logger.info(&#34;ImageViewerROI.updateROIName called.&#34;)
    self.graphicsView.currentROIName = self.cmbNamesROIs.currentText()</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateZoomSlider"><code class="name flex">
<span>def <span class="ident">updateZoomSlider</span></span>(<span>self, increment)</span>
</code></dt>
<dd>
<div class="desc"><p>This function updates the position of the slider on the image
zoom slider and calculates the % zoom for display in the label zoomLabel.
Although, the zoom slider widget is not displayed on the screen,
this function is a convenient way to keep track of the current image
zoom value</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def updateZoomSlider(self, increment):
    &#34;&#34;&#34;This function updates the position of the slider on the image
    zoom slider and calculates the % zoom for display in the label zoomLabel.
    Although, the zoom slider widget is not displayed on the screen,
    this function is a convenient way to keep track of the current image
    zoom value&#34;&#34;&#34;
    try:
        logger.info(&#34;DisplayImageDrawRIO.updateZoomSlider called&#34;)
        self.zoomSlider.blockSignals(True)
        if increment == 0:
            self.zoomSlider.setValue(0)
            self.zoomValueLabel.setText(&#34;&lt;H4&gt;100%&lt;/H4&gt;&#34;)
        else:
            newValue = self.zoomSlider.value() + increment
            newZoomValue = 100 + (newValue * 25)
            self.zoomValueLabel.setText(&#34;&lt;H4&gt;&#34; + str(newZoomValue) + &#34;%&lt;/H4&gt;&#34;)
            if self.zoomSlider.value() &lt; self.zoomSlider.maximum() and increment &gt; 0:
                self.zoomSlider.setValue(newValue)
            elif self.zoomSlider.value() &gt; self.zoomSlider.minimum() and increment &lt; 0:
                self.zoomSlider.setValue(newValue)
        self.zoomSlider.blockSignals(False)
    except Exception as e:
            print(&#39;Error in ImageViewerROI.updateZoomSlider: &#39; + str(e))
            logger.exception(&#39;Error in ImageViewerROI.updateZoomSlider: &#39; + str(e))</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.zoomImage"><code class="name flex">
<span>def <span class="ident">zoomImage</span></span>(<span>self, checked)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def zoomImage(self, checked):
    logger.info(&#34;ImageViewerROI.zoomImage called.&#34;)
    if checked:
        self.setButtonsToDefaultStyle()
        self.graphicsView.setZoomEnabled(True)
        self.graphicsView.graphicsItem.paintEnabled = False
        self.graphicsView.graphicsItem.drawEnabled = False
        self.graphicsView.graphicsItem.eraseEnabled = False
        self.btnZoom.setStyleSheet(&#34;background-color: red&#34;)
    else:
        QApplication.setOverrideCursor(QCursor(Qt.ArrowCursor))
        self.graphicsView.setZoomEnabled(False)
        self.btnZoom.setStyleSheet(
         &#34;background-color: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #CCCCBB, stop: 1 #FFFFFF)&#34;
         )</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider"><code class="flex name class">
<span>class <span class="ident">Slider</span></span>
<span>(</span><span>parent=None)</span>
</code></dt>
<dd>
<div class="desc"><p>QSlider(parent: QWidget = None)
QSlider(Qt.Orientation, parent: QWidget = None)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Slider(QSlider):
    Nothing, Forward, Backward = 0, 1, -1
    directionChanged = pyqtSignal(int)
    def __init__(self, parent=None):
        QSlider.__init__(self, parent)
        self._direction = Slider.Nothing
        self.last = self.value()/self.maximum()
        self.valueChanged.connect(self.onValueChanged)

    def onValueChanged(self, value):
        current = value/self.maximum()
        direction = Slider.Forward if self.last &lt; current else Slider.Backward
        if self._direction != direction:
            self.directionChanged.emit(direction)
            self._direction = direction
        self.last = current

    def direction(self):
        return self._direction</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QSlider</li>
<li>PyQt5.QtWidgets.QAbstractSlider</li>
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Backward"><code class="name">var <span class="ident">Backward</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Forward"><code class="name">var <span class="ident">Forward</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Nothing"><code class="name">var <span class="ident">Nothing</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.direction"><code class="name flex">
<span>def <span class="ident">direction</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def direction(self):
    return self._direction</code></pre>
</details>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.directionChanged"><code class="name flex">
<span>def <span class="ident">directionChanged</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.onValueChanged"><code class="name flex">
<span>def <span class="ident">onValueChanged</span></span>(<span>self, value)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def onValueChanged(self, value):
    current = value/self.maximum()
    direction = Slider.Forward if self.last &lt; current else Slider.Backward
    if self._direction != direction:
        self.directionChanged.emit(direction)
        self._direction = direction
    self.last = current</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="WEASEL.Displays.ImageViewers" href="index.html">WEASEL.Displays.ImageViewers</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI">ImageViewerROI</a></code></h4>
<ul class="">
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.addNewROItoDropDownList" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.addNewROItoDropDownList">addNewROItoDropDownList</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.adjustLevelsByRightMouseButtonDrag" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.adjustLevelsByRightMouseButtonDrag">adjustLevelsByRightMouseButtonDrag</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.connectSlotToSignalForROITools" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.connectSlotToSignalForROITools">connectSlotToSignalForROITools</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.deleteROITidyUp" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.deleteROITidyUp">deleteROITidyUp</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.displayPixelArrayOfSingleImage" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.displayPixelArrayOfSingleImage">displayPixelArrayOfSingleImage</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.displayROIMeanAndStd" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.displayROIMeanAndStd">displayROIMeanAndStd</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.drawROI" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.drawROI">drawROI</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.eraseROI" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.eraseROI">eraseROI</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.getPixelValue" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.getPixelValue">getPixelValue</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.getRoiMeanAndStd" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.getRoiMeanAndStd">getRoiMeanAndStd</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.loadImageInImageItem" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.loadImageInImageItem">loadImageInImageItem</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.loadROI" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.loadROI">loadROI</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.paintROI" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.paintROI">paintROI</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.replaceMask" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.replaceMask">replaceMask</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.roiNameChanged" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.roiNameChanged">roiNameChanged</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.saveROI" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.saveROI">saveROI</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setButtonsToDefaultStyle" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setButtonsToDefaultStyle">setButtonsToDefaultStyle</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setDrawButtonColour" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setDrawButtonColour">setDrawButtonColour</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setEraseButtonColour" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setEraseButtonColour">setEraseButtonColour</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setInitialImageLevelValues" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setInitialImageLevelValues">setInitialImageLevelValues</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setPaintButtonColour" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setPaintButtonColour">setPaintButtonColour</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpGraphicsView" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpGraphicsView">setUpGraphicsView</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageEventHandlers" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageEventHandlers">setUpImageEventHandlers</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageLevelsLayout" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageLevelsLayout">setUpImageLevelsLayout</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageSliders" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpImageSliders">setUpImageSliders</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpLevelsSpinBoxes" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpLevelsSpinBoxes">setUpLevelsSpinBoxes</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpMainLayout" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpMainLayout">setUpMainLayout</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpPixelValueGroupBox" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpPixelValueGroupBox">setUpPixelValueGroupBox</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpROIButtons" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpROIButtons">setUpROIButtons</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpROIDropDownList" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpROIDropDownList">setUpROIDropDownList</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpRoiToolsLayout" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpRoiToolsLayout">setUpRoiToolsLayout</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpTopRowLayout" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpTopRowLayout">setUpTopRowLayout</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpZoomGroupBox" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpZoomGroupBox">setUpZoomGroupBox</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpZoomSlider" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.setUpZoomSlider">setUpZoomSlider</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateDetailsROI" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateDetailsROI">updateDetailsROI</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateImageLevels" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateImageLevels">updateImageLevels</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateROIName" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateROIName">updateROIName</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateZoomSlider" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.updateZoomSlider">updateZoomSlider</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.zoomImage" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.ImageViewerROI.zoomImage">zoomImage</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.Slider">Slider</a></code></h4>
<ul class="two-column">
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Backward" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Backward">Backward</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Forward" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Forward">Forward</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Nothing" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.Nothing">Nothing</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.direction" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.direction">direction</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.directionChanged" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.directionChanged">directionChanged</a></code></li>
<li><code><a title="WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.onValueChanged" href="#WEASEL.Displays.ImageViewers.ImageViewerROI.Slider.onValueChanged">onValueChanged</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>